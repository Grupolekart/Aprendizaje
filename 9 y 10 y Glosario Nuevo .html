<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Examen</title>
  <style>
    :root {
      /* --- Variables de Color Modo Claro (Default) --- */
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --container-bg: rgba(255, 255, 255, .95);
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --border-color: #e2e8f0;
      --card-bg: #fff;
      --button-bg: #f7fafc;
      --button-hover-bg: #edf2f7;
      --button-secondary-bg: #e2e8f0;
      --button-secondary-hover-bg: #cbd5e0;
      --correct-bg: #e6fffa;
      --correct-border: #38a169;
      --correct-text: #2f855a;
      --incorrect-bg: #fff5f5;
      --incorrect-border: #e53e3e;
      --incorrect-text: #c53030;
    }

    .dark-mode {
      /* --- Variables de Color Modo Oscuro --- */
      --bg-gradient-start: #1a202c;
      --bg-gradient-end: #2d3748;
      --container-bg: rgba(45, 55, 72, .95);
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5e0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --card-bg: #2d3748;
      --button-bg: #4a5568;
      --button-hover-bg: #2d3748;
      --button-secondary-bg: #4a5568;
      --button-secondary-hover-bg: #718096;
      --correct-bg: #2f855a;
      --correct-border: #38a169;
      --correct-text: #e6fffa;
      --incorrect-bg: #c53030;
      --incorrect-border: #e53e3e;
      --incorrect-text: #fff5f5;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--text-primary);
      transition: background .3s ease;
    }
    .container {
      background: var(--container-bg);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      padding: 40px;
      transition: all .3s ease;
      position: relative;
    }
    /* --- BOT√ìN DE MODO D√çA/NOCHE --- */
    #theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    #theme-toggle:hover {
        background: var(--button-secondary-hover-bg);
        transform: scale(1.1) rotate(15deg);
    }

    .main-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }
    .main-header-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-secondary);
    }
    .header { text-align: center; margin-bottom: 30px; }
    .title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; color: var(--text-primary); }
    .subtitle { color: var(--text-muted); font-size: 1.1rem; }
    
    .timer-setup { margin: 20px 0; text-align: center; } /* Reducido el margen vertical */
    .timer-setup label { font-weight: 600; margin-right: 10px; font-size: 1.1rem; color: var(--text-secondary); }
    .timer-setup select {
        padding: 8px 12px;
        border-radius: 8px;
        border: 2px solid var(--border-color);
        background-color: var(--button-bg);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
    }
    .exam-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
    }
    #timer-display {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--bg-gradient-end);
        background: var(--button-bg);
        padding: 5px 15px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }
    #reset-exam-btn {
        position: absolute;
        top: -20px;
        right: -20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    #reset-exam-btn:hover { background: var(--button-secondary-hover-bg); transform: rotate(90deg); }

    .progress-container { margin-bottom: 30px; }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--bg-gradient-start), var(--bg-gradient-end));
      border-radius: 10px;
      transition: width .3s ease;
    }
    .progress-text { text-align: center; color: var(--text-secondary); font-weight: 600; }
    .question-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.06);
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
    }
    .question-number { color: var(--bg-gradient-start); font-size: .9rem; font-weight: 600; margin-bottom:15px; }
    .question-text { font-size:1.3rem; line-height:1.6; font-weight:600; margin-bottom:25px; color: var(--text-primary); }
    .options { display:grid; gap:12px; }
    .option {
      background:var(--button-bg);
      border:2px solid var(--border-color);
      border-radius:12px;
      padding:18px 20px;
      cursor:pointer;
      transition:all .2s ease;
      display:flex;
      align-items:center;
      font-size:1rem;
      color:var(--text-secondary);
      text-align: left;
    }
    .option:hover:not(.disabled) {
      border-color:var(--bg-gradient-start);
      background:var(--button-hover-bg);
      transform:translateY(-2px);
      box-shadow:0 4px 20px rgba(102,126,234,0.15);
    }
    .option.disabled { pointer-events:none; }
    .option.correct { border-color:var(--correct-border)!important; background:var(--correct-bg)!important; color:var(--correct-text)!important; }
    .option.incorrect { border-color:var(--incorrect-border)!important; background:var(--incorrect-bg)!important; color:var(--incorrect-text)!important; }
    .option-letter {
      background:var(--bg-gradient-start);
      color:white;
      width:30px;
      height:30px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      margin-right:15px;
      font-size:.9rem;
      flex-shrink: 0;
    }
    .navigation { display:flex; justify-content:space-between; align-items:center; margin-top:30px; }
    .btn {
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color:white;
      border:none;
      padding:12px 24px;
      border-radius:12px;
      cursor:pointer;
      font-size:1rem;
      font-weight:600;
      transition:all .3s ease;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn-secondary { background: var(--button-secondary-bg); color: var(--text-secondary); }
    .btn-secondary:hover:not(:disabled) { background: var(--button-secondary-hover-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .btn:hover:not(:disabled) {
      transform:translateY(-2px);
      box-shadow:0 8px 25px rgba(102,126,234,0.3);
    }
    .btn:disabled { opacity:.5; cursor:not-allowed; transform:none; box-shadow: none;}
    .hidden { display:none; }
    
    .results { text-align:center; padding:40px 20px; }
    .results h2 { font-size:2.2rem; margin-bottom:20px; color: var(--text-primary); }
    .score {
      font-size:4rem;
      font-weight:800;
      margin:30px 0;
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .score-details {
      background: var(--button-bg);
      border-radius:16px;
      padding:25px;
      margin:30px 0;
      border:1px solid var(--border-color);
    }
    .score-item { display:flex; justify-content:space-between; margin:10px 0; font-size:1.1rem; }
    .score-label { color: var(--text-secondary); }
    .score-value { font-weight:600; color: var(--text-primary); }
    .status.passed { color:#38a169; }
    .status.failed { color:#e53e3e; }

    #review-section h3 {
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
    }
    .incorrect-answer-item {
        background: var(--incorrect-bg);
        border: 1px solid var(--incorrect-border);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        text-align: left;
    }
    .incorrect-answer-item p { margin-bottom: 8px; line-height: 1.5; color: var(--text-primary); }
    .incorrect-answer-item .user-answer { color: var(--incorrect-text); }
    .incorrect-answer-item .correct-answer { color: var(--correct-text); font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <button id="theme-toggle" title="Cambiar Tema">üåì</button>
    <div class="main-header">
        <h2 class="main-header-title">Examen de Conducir: Cap√≠tulos 9, 10 y Glosario</h2>
    </div>

    <div id="start-screen">
      <div class="header">
        <h1 class="title">üìù Simulador de Examen</h1>
        <p class="subtitle">Pon a prueba tus conocimientos</p>
      </div>
      <div class="timer-setup">
          <label for="time-select">Selecciona el tiempo:</label>
          <select id="time-select">
              <option value="15" selected>15 Minutos</option>
              <option value="20">20 Minutos</option>
              <option value="25">25 Minutos</option>
              <option value="30">30 Minutos</option>
              <option value="35">35 Minutos</option>
              <option value="40">40 Minutos</option>
              <option value="45">45 Minutos</option>
              <option value="50">50 Minutos</option>
              <option value="55">55 Minutos</option>
              <option value="60">60 Minutos</option>
          </select>
      </div>

      <div class="timer-setup">
          <label for="pass-mark-select">Nota de Aprobaci√≥n:</label>
          <select id="pass-mark-select">
              <option value="50">50%</option>
              <option value="60">60%</option>
              <option value="70">70%</option>
              <option value="80">80%</option>
              <option value="85" selected>85%</option>
              <option value="90">90%</option>
              <option value="100">100%</option>
          </select>
      </div>
      <div style="text-align:center;">
         <p id="start-text" style="margin:20px 0;color: var(--text-muted);font-size:1.1rem;"></p>
        <button id="start-btn" class="btn">üöÄ Comenzar Examen</button>
      </div>
    </div>

    <div id="exam-screen" class="hidden">
      <button id="reset-exam-btn" title="Reiniciar Examen">üîÑ</button>
       <div class="exam-header">
         <h2 style="color: var(--text-muted);">Examen en Curso</h2>
         <div id="timer-display">--:--</div>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
           <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text"></div>
      </div>
      <div class="question-card">
        <div class="question-number" id="question-number"></div>
        <div class="question-text" id="question-text"></div>
        <div class="options" id="options"></div>
      </div>
      <div class="navigation">
        <button class="btn btn-secondary" id="prev-btn">‚Üê Anterior</button>
         <button class="btn" id="next-btn">Siguiente ‚Üí</button>
      </div>
    </div>

    <div id="results-screen" class="hidden">
      <div class="results">
        <h2 id="results-title">¬°Examen Completado!</h2>
        <div class="score" id="final-score"></div>
        <div class="score-details">
          <div class="score-item">
            <span class="score-label">Respuestas correctas:</span>
            <span class="score-value" id="correct-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Respuestas incorrectas:</span>
            <span class="score-value" id="incorrect-count"></span>
          </div>
          <div class="score-item">
            <span class="score-label">Total de preguntas:</span>
            <span class="score-value" id="total-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Estado:</span>
            <span class="score-value status" id="exam-status"></span>
          </div>
        </div>
        <button id="restart-btn" class="btn">üîÑ Reiniciar Examen</button>

        <div id="review-section" class="hidden" style="margin-top: 40px;">
            <h3>Revisi√≥n de Respuestas Incorrectas</h3>
            <div id="incorrect-answers-list" style="margin-top: 20px;"></div>
        </div>
      </div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', () => {
    // --- BANCO DE PREGUNTAS ---
    let questions = [
        { question: "Seg√∫n el glosario, ¬øa qu√© se destina principalmente una \"acera\"?", options: ["Al uso de veh√≠culos y animales.", "Al uso de peatones.", "A la instalaci√≥n de equipamiento y redes de servicios."], correct: 1 },
        { question: "¬øPor qu√© costado del eje de la calzada se debe efectuar un \"adelantamiento\"?", options: ["Por el costado derecho.", "Por el costado izquierdo.", "Por cualquiera de los dos costados si la v√≠a est√° despejada."], correct: 1 },
        { question: "¬øQu√© es una \"avenida o calle\"?", options: ["Una v√≠a rural destinada al uso de peatones, veh√≠culos y animales.", "Una v√≠a urbana destinada a la circulaci√≥n de peatones, veh√≠culos y animales.", "Una faja lateral adyacente a la calzada de un camino."], correct: 1 },
        { question: "¬øQu√© es una \"berma\"?", options: ["La parte de una v√≠a destinada al uso de veh√≠culos y animales.", "El √°ngulo formado por la calzada y el plano vertical de la acera.", "Una faja lateral, pavimentada o no, adyacente a la calzada de un camino."], correct: 2 },
        { question: "¬øCu√°l es la velocidad m√°xima a la que un ciclo con motor auxiliar el√©ctrico interrumpe su alimentaci√≥n?", options: ["20 km/h.", "25 km/h.", "30 km/h."], correct: 1 },
        { question: "¬øQu√© se necesita para que un espacio sea considerado una \"ciclov√≠a\"?", options: ["Ser un espacio destinado al uso exclusivo de ciclos, segregado f√≠sica o visualmente.", "Ser una pista de circulaci√≥n compartida con veh√≠culos motorizados.", "Ser una acera ancha donde se permite la circulaci√≥n de bicicletas."], correct: 0 },
        { question: "¬øQu√© abarca la definici√≥n de \"cruce\"?", options: ["Solamente la intersecci√≥n de las calzadas.", "La uni√≥n de una calle o camino con otros, incluyendo todo el ancho entre las l√≠neas de edificaci√≥n.", "√önicamente la intersecci√≥n de una calle con una v√≠a f√©rrea."], correct: 1 },
        { question: "¬øQu√© elemento es indispensable para que un cruce sea considerado \"regulado\"?", options: ["La existencia de un paso para peatones demarcado.", "La presencia de una se√±al \"CEDA EL PASO\".", "Un sem√°foro funcionando normalmente o Carabineros dirigiendo el tr√°nsito."], correct: 2 },
        { question: "¬øQu√© es una \"demarcaci√≥n\" vial?", options: ["Un dispositivo luminoso que regula la circulaci√≥n.", "Un dispositivo, signo o marca oficial instalado por la autoridad.", "Un s√≠mbolo, palabra o marca sobre la calzada para guiar el tr√°nsito."], correct: 2 },
        { question: "¬øQu√© es el \"derecho preferente de paso\"?", options: ["La obligaci√≥n de un peat√≥n o conductor de detenerse.", "La prerrogativa de un peat√≥n o conductor para proseguir su marcha.", "El permiso para exceder los l√≠mites de velocidad en una emergencia."], correct: 1 },
        { question: "¬øQu√© define una \"detenci√≥n\"?", options: ["Paralizar un veh√≠culo por un per√≠odo mayor que el necesario para dejar o recibir pasajeros.", "La paralizaci√≥n breve para recibir o dejar pasajeros, u obligada por una se√±al.", "Dejar el veh√≠culo en la v√≠a p√∫blica sin conductor."], correct: 1 },
        { question: "¬øQu√© determina el \"eje de la calzada\"?", options: ["Las √°reas de estacionamiento permitido.", "Las √°reas con sentido de tr√°nsito opuesto.", "La faja destinada al tr√°nsito de una fila de veh√≠culos."], correct: 1 },
        { question: "¬øCu√°ndo se considera que un veh√≠culo est√° \"estacionado\"?", options: ["Cuando se detiene brevemente para que suba un pasajero.", "Cuando se paraliza en la v√≠a p√∫blica por un per√≠odo mayor que el necesario para dejar o recibir pasajeros.", "Cuando se detiene por una orden de Carabineros."], correct: 1 },
        { question: "¬øQu√© es una \"intersecci√≥n\"?", options: ["La uni√≥n de una calle con una v√≠a f√©rrea.", "El v√©rtice del √°ngulo que forman las l√≠neas de edificaci√≥n.", "El √°rea com√∫n de calzadas que se cruzan o convergen."], correct: 2 },
        { question: "¬øQu√© tipo de luz permite visualizar obst√°culos a una distancia no inferior a 50 metros?", options: ["Luz alta.", "Luz de estacionamiento.", "Luz baja."], correct: 2 },
        { question: "¬øPara qu√© est√° destinada una \"pista de circulaci√≥n\"?", options: ["Al tr√°nsito de una fila de veh√≠culos.", "Exclusivamente al uso de ciertos veh√≠culos determinados por la autoridad.", "A la contenci√≥n de √°reas verdes y arbolado urbano."], correct: 0 },
        { question: "¬øQu√© maniobra se realiza sin traspasar el eje de la calzada?", options: ["Adelantamiento.", "Sobrepasar.", "Viraje en U."], correct: 1 },
        { question: "¬øCu√°l es la obligaci√≥n principal de una persona implicada en un siniestro donde resulten personas lesionadas?", options: ["Abandonar el lugar para no entorpecer el tr√°fico.", "Mover a los heridos a la acera inmediatamente.", "Detener su marcha, prestar la ayuda que fuese posible y dar cuenta a la autoridad policial."], correct: 2 },
        { question: "¬øQu√© constituye un delito que puede ser sancionado con inhabilidad de por vida para conducir?", options: ["No tener la revisi√≥n t√©cnica al d√≠a.", "Darse a la fuga y no dar aviso a la autoridad policial tras un siniestro.", "Estacionar en un lugar no permitido."], correct: 1 },
        { question: "Si un veh√≠culo involucrado en un siniestro es el√©ctrico, ¬øqu√© se debe evitar si no se tiene capacitaci√≥n?", options: ["Apagar el motor del veh√≠culo.", "Llamar a los servicios de emergencia.", "Tocar la l√≠nea de alto voltaje, identificada por su color naranjo."], correct: 2 },
        { question: "¬øCu√°l es el primer paso (letra X) en el procedimiento de primeros auxilios XABCDE?", options: ["Abrir la v√≠a a√©rea.", "Control de hemorragias graves.", "Verificar la buena ventilaci√≥n."], correct: 1 },
        { question: "¬øQu√© maniobra se debe realizar para cumplir con el paso \"A: Abrir la v√≠a a√©rea\" si la persona no responde a est√≠mulos?", options: ["La maniobra de Heimlich.", "La maniobra frente-ment√≥n.", "Realizar un torniquete."], correct: 1 },
        { question: "En el paso \"C: Circulaci√≥n\" de los primeros auxilios, ¬øqu√© se debe controlar?", options: ["Si la persona responde a est√≠mulos dolorosos.", "Si la piel est√° p√°lida, sudorosa y fr√≠a, y contener hemorragias peque√±as.", "Si el pecho de la persona se eleva al respirar."], correct: 1 },
        { question: "¬øQu√© significa la letra \"I\" en la escala de conciencia del paso \"D: D√©ficit de conciencia\"?", options: ["Alerta.", "Responde a la voz.", "Inconsciente."], correct: 2 },
        { question: "¬øQu√© se debe hacer si se encuentra con un siniestro de un veh√≠culo que transporta cargas peligrosas?", options: ["Acercarse inmediatamente para prestar ayuda.", "Mantenerse a una distancia prudente y ubicarse donde el viento no corra desde el veh√≠culo hacia uno.", "Encender una llama para tener mejor visibilidad en la noche."], correct: 1 },
        { question: "¬øQu√© indica el r√≥tulo con un rombo naranjo que dice \"EXPLOSIVOS\"?", options: ["Que el veh√≠culo transporta material corrosivo.", "Que el veh√≠culo transporta una carga explosiva.", "Que el veh√≠culo transporta l√≠quido combustible."], correct: 1 },
        { question: "¬øQu√© documentos, adem√°s de la placa patente, no pueden faltar en un veh√≠culo para poder circular?", options: ["El manual del propietario y la boleta de compra.", "El permiso de circulaci√≥n y el certificado de un Seguro Obligatorio de Accidentes Personales (SOAP).", "La licencia de conducir y el certificado de antecedentes del conductor."], correct: 1 },
        { question: "¬øQu√© organismo otorga las Placas Patentes √önicas (PPU)?", options: ["La Municipalidad correspondiente.", "El Ministerio de Transportes y Telecomunicaciones.", "El Servicio de Registro Civil e Identificaci√≥n."], correct: 2 },
        { question: "¬øQu√© cubre el Seguro Obligatorio de Accidentes Personales (SOAP)?", options: ["Los da√±os materiales del veh√≠culo asegurado.", "Los riesgos de muerte y lesiones corporales de las personas involucradas en un siniestro.", "Las multas de tr√°nsito del conductor."], correct: 1 },
        { question: "¬øQu√© se chequea en la revisi√≥n t√©cnica de un veh√≠culo?", options: ["El nivel de combustible y el estado de la pintura.", "Los sistemas de direcci√≥n, frenos, luces, neum√°ticos y combusti√≥n interna, entre otros.", "El funcionamiento del sistema de audio y aire acondicionado."], correct: 1 },
        { question: "Seg√∫n la tabla, si la patente de un veh√≠culo termina en 2, ¬øen qu√© mes le corresponde la revisi√≥n t√©cnica?", options: ["Abril.", "Mayo.", "Junio."], correct: 1 },
        { question: "¬øQu√© proh√≠be espec√≠ficamente la Ley \"No Chat\" mientras se conduce?", options: ["Escuchar el GPS si el dispositivo no viene de f√°brica.", "Manipular con las manos un celular, incluso si el veh√≠culo est√° detenido en una luz roja.", "Utilizar un sistema de manos libres para realizar llamadas."], correct: 1 },
        { question: "¬øQu√© requisito debe cumplir el acompa√±ante de un conductor de 17 a√±os?", options: ["Tener una licencia de conducir de al menos 1 a√±o de antig√ºedad.", "Tener una licencia Clase B de no menos de 5 a√±os de antig√ºedad.", "Ser mayor de 25 a√±os."], correct: 1 },
        { question: "¬øPor cu√°nto tiempo se suspende la licencia por conducir bajo la influencia del alcohol?", options: ["1 mes.", "2 a√±os.", "3 meses."], correct: 2 },
        { question: "¬øCu√°l es la sanci√≥n por exceder en m√°s de 60 km/h un l√≠mite de velocidad m√°xima?", options: ["Suspensi√≥n de licencia por 45 d√≠as.", "Suspensi√≥n de licencia por 6 meses.", "Inhabilitaci√≥n de por vida para conducir."], correct: 1 },
        { question: "¬øQu√© tipo de infracci√≥n es no detenerse ante una se√±al \"PARE\"?", options: ["Menos grave.", "Grave.", "Grav√≠sima."], correct: 2 },
        { question: "¬øEs una infracci√≥n grav√≠sima el traslado de menores de 12 a√±os en los asientos delanteros?", options: ["S√≠, es una infracci√≥n grav√≠sima.", "No, es una infracci√≥n leve.", "Solo si el menor no usa cintur√≥n de seguridad."], correct: 0 },
        { question: "¬øQu√© tipo de infracci√≥n es exceder de 11 a 20 km/h el l√≠mite de velocidad m√°xima?", options: ["Grave.", "Leve.", "Grav√≠sima."], correct: 0 },
        { question: "¬øQu√© acci√≥n es considerada una infracci√≥n grave respecto al adelantamiento?", options: ["Adelantar en una zona rural con buena visibilidad.", "Sobrepasar o adelantar en un puente, viaducto, t√∫nel o cruce de ferrocarril.", "Adelantar a un veh√≠culo que va a baja velocidad."], correct: 1 },
        { question: "¬øConstituye una infracci√≥n grave conducir sin usar el cintur√≥n de seguridad?", options: ["Solo si se produce un siniestro.", "No, es una infracci√≥n leve.", "S√≠, es una infracci√≥n grave."], correct: 2 },
        { question: "¬øEn qu√© categor√≠a de infracci√≥n se clasifica el no respetar el derecho preferente de paso de un peat√≥n?", options: ["Menos grave.", "Grave.", "Leve."], correct: 1 },
        { question: "¬øEs una infracci√≥n conducir un veh√≠culo con el sistema de direcci√≥n o de frenos en condiciones deficientes?", options: ["S√≠, es una infracci√≥n grave.", "S√≠, pero solo si es detectado en la revisi√≥n t√©cnica.", "No, es una falta leve."], correct: 0 },
        { question: "¬øQu√© tipo de infracci√≥n es no bajar las luces en carretera al enfrentar o acercarse por detr√°s a otro veh√≠culo?", options: ["Leve.", "Grave.", "Menos grave."], correct: 1 },
        { question: "¬øQu√© tipo de infracci√≥n es estacionar o detener un veh√≠culo en lugares prohibidos, si no est√° clasificado como grav√≠sima?", options: ["Menos grave.", "Grave.", "Leve."], correct: 0 },
        { question: "¬øCu√°l es la t√©cnica de frenado recomendada para un veh√≠culo sin frenos ABS?", options: ["Pisar el pedal a fondo y mantener la presi√≥n.", "Pisar en√©rgicamente el pedal y reducir la fuerza progresivamente a medida que disminuye la velocidad.", "Pisar el embrague antes de empezar a frenar."], correct: 1 },
        { question: "Si las ruedas de un veh√≠culo sin ABS se bloquean al frenar, ¬øqu√© debe hacer el conductor?", options: ["Aumentar la presi√≥n sobre el pedal de freno.", "Reducir ligeramente la presi√≥n sobre el pedal hasta que las ruedas dejen de patinar.", "Poner el freno de mano inmediatamente."], correct: 1 },
        { question: "Ante una falla total de frenos, si presionar y soltar el pedal no funciona, ¬øcu√°l es el siguiente paso recomendado?", options: ["Buscar inmediatamente una pista de emergencia.", "Soltar el acelerador y reducir a cambios m√°s bajos para usar el freno del motor.", "Rozar el veh√≠culo contra un borde de cerro o una defensa caminera."], correct: 1 },
        { question: "¬øQu√© contaminante emitido por los veh√≠culos contribuye al efecto invernadero?", options: ["√ìxido de carbono.", "Di√≥xido de carbono.", "Plomo."], correct: 1 },
        { question: "¬øQu√© efecto nocivo tienen los √≥xidos n√≠tricos emitidos por los veh√≠culos?", options: ["Provocan lesiones en el sistema nervioso central.", "Influyen en el sistema card√≠aco y vascular.", "Irritan las mucosas, el sistema respiratorio y contribuyen a la acidificaci√≥n."], correct: 2 },
        { question: "¬øQu√© puede indicar que el filtro de aire de un veh√≠culo est√© sucio?", options: ["El veh√≠culo emite humo muy negro por el tubo de escape.", "El motor se sobrecalienta con frecuencia.", "Se produce un temblor en el pedal de freno."], correct: 0 },
        { question: "¬øQu√© tipo de etiqueta deben tener los veh√≠culos para su identificaci√≥n como ecol√≥gicos?", options: ["Una etiqueta roja con el s√≠mbolo de una bater√≠a.", "Una etiqueta verde que diga \"Veh√≠culo El√©ctrico\" o \"Veh√≠culo H√≠brido\".", "Una calcoman√≠a azul en la luneta."], correct: 1 },
        { question: "¬øQu√© indica la se√±al reglamentaria con forma de oct√°gono rojo y la palabra \"PARE\" en blanco?", options: ["Ceda el paso.", "Pare.", "No entrar."], correct: 1 },
        { question: "¬øQu√© significa la se√±al con un tri√°ngulo invertido de borde rojo y fondo blanco?", options: ["Peligro.", "Pare.", "Ceda el paso."], correct: 2 },
        { question: "¬øQu√© proh√≠be la se√±al con un c√≠rculo rojo y una flecha negra en forma de \"U\" tachada?", options: ["No virar a la derecha.", "No virar en U.", "No cambiar de pista."], correct: 1 },
        { question: "¬øA qui√©n se le da preferencia al virar a la derecha si se encuentra una se√±al de preferencia ciclista?", options: ["A los peatones.", "A los veh√≠culos que vienen en sentido contrario.", "A los ciclistas."], correct: 2 },
        { question: "¬øQu√© proh√≠be una se√±al que muestra un cami√≥n dentro de un c√≠rculo rojo?", options: ["La circulaci√≥n de buses.", "La circulaci√≥n de veh√≠culos de carga.", "El estacionamiento de veh√≠culos de carga."], correct: 1 },
        { question: "¬øQu√© indica la se√±al con una letra \"E\" tachada dentro de un c√≠rculo rojo?", options: ["Prohibido estacionar y detenerse.", "Prohibido estacionar.", "Fin de la prohibici√≥n de estacionar."], correct: 1 },
        { question: "¬øQu√© indica la se√±al con el n√∫mero \"40\" y la palabra \"M√çNIMA\" en un recuadro azul?", options: ["Velocidad m√°xima 40 km/h.", "Velocidad m√≠nima 40 km/h.", "Pr√≥xima zona de 40 km/h."], correct: 1 },
        { question: "¬øQu√© restricci√≥n impone la se√±al que muestra un cami√≥n con la indicaci√≥n \"+10m\" dentro de un c√≠rculo rojo?", options: ["Proh√≠be la circulaci√≥n a veh√≠culos de m√°s de 10 metros de largo.", "Proh√≠be la circulaci√≥n a veh√≠culos de m√°s de 10 toneladas.", "Indica una distancia de seguridad de 10 metros."], correct: 0 },
        { question: "¬øQu√© significa la se√±al que indica \"TR√ÅNSITO EN AMBOS SENTIDOS\"?", options: ["La v√≠a es de un solo sentido.", "La v√≠a tiene tr√°nsito en ambas direcciones.", "Se debe circular por la derecha."], correct: 1 },
        { question: "¬øQu√© obligaci√≥n impone la se√±al azul con una flecha blanca apuntando hacia la derecha?", options: ["Paso obligado a la derecha.", "Direcci√≥n obligada.", "Tr√°nsito en un solo sentido."], correct: 1 },
        { question: "¬øQu√© indica la se√±al redonda azul que muestra una rotonda?", options: ["Proximidad de rotonda.", "Minirrotonda.", "Paso v√©rtice."], correct: 1 },
        { question: "¬øQu√© significa la se√±al redonda azul con un pictograma de un neum√°tico con cadenas?", options: ["Prohibido el uso de cadenas.", "Uso obligatorio de cadenas.", "Zona de venta de cadenas."], correct: 1 },
        { question: "¬øA qu√© se refiere la se√±al azul con la palabra \"SOLO BUSES\"?", options: ["A una parada de buses.", "A una v√≠a segregada para buses.", "Al estacionamiento exclusivo para buses."], correct: 1 },
        { question: "¬øQu√© advierte la se√±al de peligro con una flecha en forma de \"S\" que primero va a la derecha?", options: ["Zona de curvas a la derecha.", "Curva y contracurva a la derecha.", "Curva muy cerrada a la derecha."], correct: 1 },
        { question: "¬øQu√© indica la se√±al de peligro que muestra un veh√≠culo en una pendiente hacia abajo?", options: ["Pendiente fuerte en subida.", "Pendiente fuerte en bajada.", "Proyecci√≥n de gravilla."], correct: 1 },
        { question: "¬øQu√© advierte la se√±al con el pictograma de un t√∫nel?", options: ["Salida de t√∫nel.", "Proximidad de t√∫nel.", "T√∫nel con poca iluminaci√≥n."], correct: 1 },
        { question: "¬øQu√© significa la se√±al de peligro con una manga de viento?", options: ["Viento lateral.", "Aeropuerto o aer√≥dromo.", "Zona de avalancha."], correct: 0 },
        { question: "¬øQu√© indica la se√±al de peligro que muestra una v√≠a estrech√°ndose por la derecha?", options: ["Ensanchamiento a la derecha.", "Angostamiento a la derecha.", "Inicio de mediana."], correct: 1 },
        { question: "¬øQu√© advierte la se√±al de peligro con el pictograma de un lomo de toro?", options: ["Bad√©n.", "Resalto.", "Resaltos sucesivos."], correct: 1 },
        { question: "¬øQu√© significa la se√±al de peligro con un veh√≠culo del que caen piedras?", options: ["Zona de derrumbes.", "Pavimento resbaladizo.", "Proyecci√≥n de gravilla."], correct: 2 },
        { question: "¬øQu√© advierte la se√±al con un pictograma de una reja o barrera?", options: ["Cruce ferroviario a nivel sin barreras.", "Cruce ferroviario a nivel con barreras.", "Barreras en la v√≠a por trabajos."], correct: 1 },
        { question: "¬øQu√© indica una se√±al de advertencia con una cruz?", options: ["Proximidad de hospital.", "Cruces, bifurcaciones y convergencias.", "Cruce de San Andr√©s."], correct: 1 },
        { question: "¬øQu√© advierte la se√±al con la figura de un ciervo?", options: ["Zona de caza.", "Animales en la v√≠a.", "Cruce de ganado."], correct: 1 },
        { question: "¬øQu√© indica la se√±al de peligro con un sem√°foro dentro del rombo amarillo?", options: ["Sem√°foro fuera de servicio.", "Proximidad de sem√°foro.", "Fin de zona con sem√°foros."], correct: 1 },
        { question: "¬øQu√© significa la se√±al de peligro que muestra una se√±al \"PARE\" dentro del rombo amarillo?", options: ["Proximidad de se√±al \"PARE\".", "Zona de detenci√≥n obligatoria.", "Fin de la obligaci√≥n de parar."], correct: 0 },
        { question: "¬øQu√© indica la se√±al informativa que muestra distancias a diferentes ciudades?", options: ["De direcci√≥n.", "De localizaci√≥n.", "De confirmaci√≥n."], correct: 2 },
        { question: "¬øQu√© tipo de se√±al es la que indica \"Aeropuerto Arturo Merino Ben√≠tez\"?", options: ["De direcci√≥n.", "De localizaci√≥n.", "De atractivo tur√≠stico."], correct: 1 },
        { question: "¬øQu√© tipo de informaci√≥n entregan las se√±ales de color caf√©?", options: ["Informaci√≥n de servicios como tel√©fonos y hospitales.", "Informaci√≥n sobre atractivos tur√≠sticos o recreacionales.", "Informaci√≥n sobre autopistas y carreteras."], correct: 1 },
        { question: "¬øQu√© servicio indica la se√±al azul con el pictograma de una cama?", options: ["Primeros auxilios.", "Alojamiento.", "Servicios higi√©nicos."], correct: 1 },
        { question: "¬øQu√© actividad tur√≠stica representa la se√±al caf√© con una persona sobre un caballo?", options: ["Artesan√≠a.", "Buceo.", "Cabalgata."], correct: 2 },
        { question: "¬øQu√© indica la se√±al de autopista con una flecha saliendo de la v√≠a principal hacia la derecha?", options: ["Inicio de autopista.", "Retorno en autopista.", "Salida lateral derecha."], correct: 2 },
        { question: "¬øQu√© significa la se√±al que muestra el s√≠mbolo de una autopista tachado con una l√≠nea roja?", options: ["Inicio de autopista.", "Fin de autopista.", "Autopista en reparaci√≥n."], correct: 1 },
        { question: "¬øQu√© indica la se√±al informativa con una letra \"E\" en un recuadro azul?", options: ["Zona escolar.", "Estacionamiento permitido.", "Parada de emergencia."], correct: 1 },
        { question: "¬øQu√© indica la se√±al verde que dice \"PISTA SOLO BUSES\"?", options: ["Parada mixta.", "Zona de espera para buses.", "Pista solo para buses."], correct: 2 },
        { question: "¬øA qu√© se refiere la se√±al azul que muestra una bicicleta y debajo un auto?", options: ["Ciclocalle.", "Fin de ciclov√≠a.", "Superficie segregada motorizados-ciclos."], correct: 0 },
        { question: "¬øQu√© indica la se√±al redonda, dividida verticalmente, con una bicicleta a la izquierda y un auto a la derecha?", options: ["Ciclocalle.", "Superficie segregada motorizados-ciclos.", "Preferencia ciclistas al cambiar de pista."], correct: 1 },
        { question: "¬øQu√© indica la se√±al transitoria naranja con una flecha curva hacia la derecha?", options: ["Desv√≠o a la derecha.", "Curva a la derecha.", "Fin de desv√≠o."], correct: 1 },
        { question: "¬øQu√© significa la se√±al transitoria rectangular que dice \"DESV√çO\"?", options: ["Fin de desv√≠o.", "Proximidad de desv√≠o.", "Desv√≠o."], correct: 2 },
        { question: "¬øQu√© advierte la se√±al transitoria de color amarillo con un trabajador?", options: ["La presencia de un banderero.", "El inicio de la presencia de trabajos en la v√≠a.", "El fin de los trabajos."], correct: 1 }
    ];
    // --- VARIABLES GLOBALES ---
    let currentQuestionIndex;
    let userAnswers;
    let timerInterval;
    let shuffledQuestions = [];
    let passMark; // NUEVO

    // --- ELEMENTOS DEL DOM ---
    const startScreen = document.getElementById('start-screen');
    const examScreen = document.getElementById('exam-screen');
    const resultsScreen = document.getElementById('results-screen');
    const startBtn = document.getElementById('start-btn');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const restartBtn = document.getElementById('restart-btn');
    const resetExamBtn = document.getElementById('reset-exam-btn');
    const timeSelect = document.getElementById('time-select');
    const passMarkSelect = document.getElementById('pass-mark-select'); // NUEVO
    const startText = document.getElementById('start-text');
    const timerDisplay = document.getElementById('timer-display');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const resultsTitle = document.getElementById('results-title');
    const correctCountEl = document.getElementById('correct-count');
    const incorrectCountEl = document.getElementById('incorrect-count');
    const totalCountEl = document.getElementById('total-count');
    const finalScoreEl = document.getElementById('final-score');
    const examStatusEl = document.getElementById('exam-status');
    const reviewSection = document.getElementById('review-section');
    const incorrectAnswersList = document.getElementById('incorrect-answers-list');
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body; 

    // --- FUNCIONES ---

    function toggleTheme() {
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            localStorage.setItem('theme', 'light-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark-mode') {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            body.classList.remove('dark-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function randomizeQuestionOptions() {
        shuffledQuestions = JSON.parse(JSON.stringify(questions));
        shuffledQuestions.forEach(q => {
            const correctAnswerText = q.options[q.correct];
            shuffleArray(q.options);
            const newCorrectIndex = q.options.findIndex(option => option === correctAnswerText);
            q.correct = newCorrectIndex;
        });
    }

    function initializeApp() {
        if (questions.length > 0) {
            startText.textContent = `Prep√°rate con ${questions.length} preguntas.`;
            startBtn.disabled = false;
        } else {
            startText.textContent = 'No hay preguntas cargadas. Agrega preguntas en el array "questions" para comenzar.';
            startBtn.disabled = true;
        }
        startBtn.addEventListener('click', startExam);
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', prevQuestion);
        restartBtn.addEventListener('click', restartExam);
        resetExamBtn.addEventListener('click', restartExam);
        themeToggle.addEventListener('click', toggleTheme);
        loadTheme();
    }

    function startExam() {
      randomizeQuestionOptions();
      currentQuestionIndex = 0;
      userAnswers = new Array(shuffledQuestions.length).fill(null);
      startScreen.classList.add('hidden');
      resultsScreen.classList.add('hidden');
      examScreen.classList.remove('hidden');
      reviewSection.classList.add('hidden');
      
      // NUEVO: Capturar el valor de la nota de aprobaci√≥n
      passMark = parseInt(passMarkSelect.value, 10);
      
      const durationMinutes = parseInt(timeSelect.value, 10);
      startTimer(durationMinutes);
      showQuestion();
    }
    
    function showQuestion() {
        const q = shuffledQuestions[currentQuestionIndex];
        if (!q) return; 

        updateProgress();
        questionNumberEl.textContent = `Pregunta ${currentQuestionIndex + 1}`;
        questionTextEl.textContent = q.question;
        optionsContainer.innerHTML = '';
        const answered = userAnswers[currentQuestionIndex] !== null;
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option';
            btn.innerHTML = `<span class="option-letter">${String.fromCharCode(65 + idx)}</span>${opt}`;
            btn.onclick = () => selectOption(idx);
            
            if (answered) {
               btn.classList.add('disabled');
                if (idx === q.correct) {
                    btn.classList.add('correct');
                } else if (idx === userAnswers[currentQuestionIndex]) {
                    btn.classList.add('incorrect');
                 }
            }
            optionsContainer.appendChild(btn);
        });
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.textContent = (currentQuestionIndex === shuffledQuestions.length - 1) ? 'Finalizar Examen' : 'Siguiente ‚Üí';
    }

    function selectOption(selectedIndex) {
      if (userAnswers[currentQuestionIndex] !== null) return; 
      userAnswers[currentQuestionIndex] = selectedIndex;
      showQuestion();
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < shuffledQuestions.length - 1) {
        currentQuestionIndex++;
        showQuestion();
      } else {
        showResults("¬°Examen Completado!");
      }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            showQuestion();
        }
    }

    function showResults(title) {
        clearInterval(timerInterval);
        examScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        resultsTitle.textContent = title;
        const correctCount = userAnswers.filter((answer, index) => answer === shuffledQuestions[index].correct).length;
        const totalAnswered = userAnswers.filter(answer => answer !== null).length;
        const incorrectCount = totalAnswered - correctCount;
        const score = shuffledQuestions.length > 0 ? Math.round((correctCount / shuffledQuestions.length) * 100) : 0;
        
        correctCountEl.textContent = correctCount;
        incorrectCountEl.textContent = incorrectCount;
        totalCountEl.textContent = shuffledQuestions.length;
        finalScoreEl.textContent = `${score}%`;

        // NUEVO: Usar la variable 'passMark' en lugar de un valor fijo
        if (score >= passMark) {
            examStatusEl.textContent = 'Aprobado';
            examStatusEl.className = 'score-value status passed';
        } else {
            examStatusEl.textContent = 'Reprobado';
            examStatusEl.className = 'score-value status failed';
        }
        
        displayIncorrectAnswers();
    }

    function displayIncorrectAnswers() {
        incorrectAnswersList.innerHTML = '';
        const incorrectAnswers = [];

        userAnswers.forEach((answer, index) => {
            if (answer !== null && answer !== shuffledQuestions[index].correct) {
                const q = shuffledQuestions[index];
                incorrectAnswers.push({
                    questionNumber: index + 1,
                    question: q.question,
                    userAnswer: q.options[answer],
                    correctAnswer: q.options[q.correct]
                });
            }
        });
        if (incorrectAnswers.length > 0) {
            reviewSection.classList.remove('hidden');
            incorrectAnswers.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'incorrect-answer-item';
                itemEl.innerHTML = `
                    <p><strong>Pregunta ${item.questionNumber}:</strong> ${item.question}</p>
                    <p class="user-answer"><strong>Tu respuesta:</strong> ${item.userAnswer}</p>
                    <p class="correct-answer"><strong>Respuesta correcta:</strong> ${item.correctAnswer}</p>
                `;
                incorrectAnswersList.appendChild(itemEl);
            });
        } else {
            reviewSection.classList.add('hidden');
        }
    }

    function restartExam() {
        clearInterval(timerInterval);
        startScreen.classList.remove('hidden');
        examScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        reviewSection.classList.add('hidden');
        initializeApp(); // Re-inicializamos para verificar si hay preguntas
    }

    function startTimer(minutes) {
        let timeInSeconds = minutes * 60;
        timerInterval = setInterval(() => {
            if (timeInSeconds <= 0) {
                clearInterval(timerInterval);
                timerDisplay.textContent = "00:00";
                showResults("¬°Se acab√≥ el tiempo!");
                return;
               }

            timeInSeconds--;
            const remMinutes = Math.floor(timeInSeconds / 60);
            const remSeconds = timeInSeconds % 60;
            timerDisplay.textContent = `${String(remMinutes).padStart(2, '0')}:${String(remSeconds).padStart(2, '0')}`;
        }, 1000);
    }
    
    function updateProgress() {
      const percentage = shuffledQuestions.length > 0 ?
      ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100 : 0;
      progressFill.style.width = percentage + '%';
      progressText.textContent = `Pregunta ${currentQuestionIndex + 1} de ${shuffledQuestions.length}`;
    }

    // --- INICIAR APP ---
    initializeApp();
});
</script>
</body>
</html>