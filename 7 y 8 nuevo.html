<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Examen</title>
  <style>
    :root {
      /* --- Variables de Color Modo Claro (Default) --- */
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --container-bg: rgba(255, 255, 255, .95);
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --border-color: #e2e8f0;
      --card-bg: #fff;
      --button-bg: #f7fafc;
      --button-hover-bg: #edf2f7;
      --button-secondary-bg: #e2e8f0;
      --button-secondary-hover-bg: #cbd5e0;
      --correct-bg: #e6fffa;
      --correct-border: #38a169;
      --correct-text: #2f855a;
      --incorrect-bg: #fff5f5;
      --incorrect-border: #e53e3e;
      --incorrect-text: #c53030;
    }

    .dark-mode {
      /* --- Variables de Color Modo Oscuro --- */
      --bg-gradient-start: #1a202c;
      --bg-gradient-end: #2d3748;
      --container-bg: rgba(45, 55, 72, .95);
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5e0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --card-bg: #2d3748;
      --button-bg: #4a5568;
      --button-hover-bg: #2d3748;
      --button-secondary-bg: #4a5568;
      --button-secondary-hover-bg: #718096;
      --correct-bg: #2f855a;
      --correct-border: #38a169;
      --correct-text: #e6fffa;
      --incorrect-bg: #c53030;
      --incorrect-border: #e53e3e;
      --incorrect-text: #fff5f5;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--text-primary);
      transition: background .3s ease;
    }
    .container {
      background: var(--container-bg);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      padding: 40px;
      transition: all .3s ease;
      position: relative;
    }
    /* --- BOT√ìN DE MODO D√çA/NOCHE --- */
    #theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    #theme-toggle:hover {
        background: var(--button-secondary-hover-bg);
        transform: scale(1.1) rotate(15deg);
    }

    .main-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }
    .main-header-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-secondary);
    }
    .header { text-align: center; margin-bottom: 30px; }
    .title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; color: var(--text-primary); }
    .subtitle { color: var(--text-muted); font-size: 1.1rem; }
    
    .timer-setup { margin: 20px 0; text-align: center; } /* Reducido el margen vertical */
    .timer-setup label { font-weight: 600; margin-right: 10px; font-size: 1.1rem; color: var(--text-secondary); }
    .timer-setup select {
        padding: 8px 12px;
        border-radius: 8px;
        border: 2px solid var(--border-color);
        background-color: var(--button-bg);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
    }
    .exam-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
    }
    #timer-display {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--bg-gradient-end);
        background: var(--button-bg);
        padding: 5px 15px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }
    #reset-exam-btn {
        position: absolute;
        top: -20px;
        right: -20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    #reset-exam-btn:hover { background: var(--button-secondary-hover-bg); transform: rotate(90deg); }

    .progress-container { margin-bottom: 30px; }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--bg-gradient-start), var(--bg-gradient-end));
      border-radius: 10px;
      transition: width .3s ease;
    }
    .progress-text { text-align: center; color: var(--text-secondary); font-weight: 600; }
    .question-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.06);
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
    }
    .question-number { color: var(--bg-gradient-start); font-size: .9rem; font-weight: 600; margin-bottom:15px; }
    .question-text { font-size:1.3rem; line-height:1.6; font-weight:600; margin-bottom:25px; color: var(--text-primary); }
    .options { display:grid; gap:12px; }
    .option {
      background:var(--button-bg);
      border:2px solid var(--border-color);
      border-radius:12px;
      padding:18px 20px;
      cursor:pointer;
      transition:all .2s ease;
      display:flex;
      align-items:center;
      font-size:1rem;
      color:var(--text-secondary);
      text-align: left;
    }
    .option:hover:not(.disabled) {
      border-color:var(--bg-gradient-start);
      background:var(--button-hover-bg);
      transform:translateY(-2px);
      box-shadow:0 4px 20px rgba(102,126,234,0.15);
    }
    .option.disabled { pointer-events:none; }
    .option.correct { border-color:var(--correct-border)!important; background:var(--correct-bg)!important; color:var(--correct-text)!important; }
    .option.incorrect { border-color:var(--incorrect-border)!important; background:var(--incorrect-bg)!important; color:var(--incorrect-text)!important; }
    .option-letter {
      background:var(--bg-gradient-start);
      color:white;
      width:30px;
      height:30px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      margin-right:15px;
      font-size:.9rem;
      flex-shrink: 0;
    }
    .navigation { display:flex; justify-content:space-between; align-items:center; margin-top:30px; }
    .btn {
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color:white;
      border:none;
      padding:12px 24px;
      border-radius:12px;
      cursor:pointer;
      font-size:1rem;
      font-weight:600;
      transition:all .3s ease;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn-secondary { background: var(--button-secondary-bg); color: var(--text-secondary); }
    .btn-secondary:hover:not(:disabled) { background: var(--button-secondary-hover-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .btn:hover:not(:disabled) {
      transform:translateY(-2px);
      box-shadow:0 8px 25px rgba(102,126,234,0.3);
    }
    .btn:disabled { opacity:.5; cursor:not-allowed; transform:none; box-shadow: none;}
    .hidden { display:none; }
    
    .results { text-align:center; padding:40px 20px; }
    .results h2 { font-size:2.2rem; margin-bottom:20px; color: var(--text-primary); }
    .score {
      font-size:4rem;
      font-weight:800;
      margin:30px 0;
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .score-details {
      background: var(--button-bg);
      border-radius:16px;
      padding:25px;
      margin:30px 0;
      border:1px solid var(--border-color);
    }
    .score-item { display:flex; justify-content:space-between; margin:10px 0; font-size:1.1rem; }
    .score-label { color: var(--text-secondary); }
    .score-value { font-weight:600; color: var(--text-primary); }
    .status.passed { color:#38a169; }
    .status.failed { color:#e53e3e; }

    #review-section h3 {
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
    }
    .incorrect-answer-item {
        background: var(--incorrect-bg);
        border: 1px solid var(--incorrect-border);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        text-align: left;
    }
    .incorrect-answer-item p { margin-bottom: 8px; line-height: 1.5; color: var(--text-primary); }
    .incorrect-answer-item .user-answer { color: var(--incorrect-text); }
    .incorrect-answer-item .correct-answer { color: var(--correct-text); font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <button id="theme-toggle" title="Cambiar Tema">üåì</button>
    <div class="main-header">
        <h2 class="main-header-title">Nombre de la Asignatura o Tema</h2>
    </div>

    <div id="start-screen">
      <div class="header">
        <h1 class="title">üìù Simulador de Examen</h1>
        <p class="subtitle">Pon a prueba tus conocimientos</p>
      </div>
      <div class="timer-setup">
          <label for="time-select">Selecciona el tiempo:</label>
          <select id="time-select">
              <option value="15" selected>15 Minutos</option>
              <option value="20">20 Minutos</option>
              <option value="25">25 Minutos</option>
              <option value="30">30 Minutos</option>
              <option value="35">35 Minutos</option>
              <option value="40">40 Minutos</option>
              <option value="45">45 Minutos</option>
              <option value="50">50 Minutos</option>
              <option value="55">55 Minutos</option>
              <option value="60">60 Minutos</option>
          </select>
      </div>

      <div class="timer-setup">
          <label for="pass-mark-select">Nota de Aprobaci√≥n:</label>
          <select id="pass-mark-select">
              <option value="50">50%</option>
              <option value="60">60%</option>
              <option value="70">70%</option>
              <option value="80">80%</option>
              <option value="85" selected>85%</option>
              <option value="90">90%</option>
              <option value="100">100%</option>
          </select>
      </div>
      <div style="text-align:center;">
         <p id="start-text" style="margin:20px 0;color: var(--text-muted);font-size:1.1rem;"></p>
        <button id="start-btn" class="btn">üöÄ Comenzar Examen</button>
      </div>
    </div>

    <div id="exam-screen" class="hidden">
      <button id="reset-exam-btn" title="Reiniciar Examen">üîÑ</button>
       <div class="exam-header">
         <h2 style="color: var(--text-muted);">Examen en Curso</h2>
         <div id="timer-display">--:--</div>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
           <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text"></div>
      </div>
      <div class="question-card">
        <div class="question-number" id="question-number"></div>
        <div class="question-text" id="question-text"></div>
        <div class="options" id="options"></div>
      </div>
      <div class="navigation">
        <button class="btn btn-secondary" id="prev-btn">‚Üê Anterior</button>
         <button class="btn" id="next-btn">Siguiente ‚Üí</button>
      </div>
    </div>

    <div id="results-screen" class="hidden">
      <div class="results">
        <h2 id="results-title">¬°Examen Completado!</h2>
        <div class="score" id="final-score"></div>
        <div class="score-details">
          <div class="score-item">
            <span class="score-label">Respuestas correctas:</span>
            <span class="score-value" id="correct-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Respuestas incorrectas:</span>
            <span class="score-value" id="incorrect-count"></span>
          </div>
          <div class="score-item">
            <span class="score-label">Total de preguntas:</span>
            <span class="score-value" id="total-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Estado:</span>
            <span class="score-value status" id="exam-status"></span>
          </div>
        </div>
        <button id="restart-btn" class="btn">üîÑ Reiniciar Examen</button>

        <div id="review-section" class="hidden" style="margin-top: 40px;">
            <h3>Revisi√≥n de Respuestas Incorrectas</h3>
            <div id="incorrect-answers-list" style="margin-top: 20px;"></div>
        </div>
      </div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', () => {
    // --- BANCO DE PREGUNTAS ---
    // AGREGA TUS PREGUNTAS AQU√ç. Sigue el formato: { question: "Texto de la pregunta", options: ["Opci√≥n A", "Opci√≥n B", "Opci√≥n C"], correct: √≠ndice_de_la_opci√≥n_correcta (0, 1, o 2) },
    let questions = [
        { question: "En la oscuridad, ¬øcu√°l es uno de los principales riesgos mencionados que aumenta la probabilidad de siniestros?", options: ["La mejora de la capacidad para calcular distancias.", "La limitada capacidad del ser humano para ver en la oscuridad.", "La menor potencia de las luces de los veh√≠culos modernos."], correct: 1 },
        { question: "¬øC√≥mo afecta la oscuridad a la percepci√≥n de las distancias, especialmente con el tr√°fico en sentido contrario?", options: ["Los colores y contornos se ven m√°s claros, mejorando el c√°lculo de distancias.", "El tr√°fico en sentido contrario parece encontrarse m√°s lejos de lo que realmente est√°.", "El tr√°fico en sentido contrario parece estar m√°s cerca de lo que realmente est√°."], correct: 1 },
        { question: "¬øDe qu√© factores dependen las posibilidades de descubrir un obst√°culo al conducir en la oscuridad?", options: ["√önicamente de la velocidad del veh√≠culo.", "De la potencia y ajuste de las luces, la capacidad visual y la capacidad de reflejar la luz que tenga el obst√°culo, entre otros.", "Solo de las condiciones clim√°ticas."], correct: 1 },
        { question: "Seg√∫n la tabla de distancias de visibilidad, ¬øa qu√© distancia se puede ver a un peat√≥n con ropas oscuras si se utilizan las luces bajas?", options: ["60 metros.", "25 metros.", "150 metros."], correct: 1 },
        { question: "Seg√∫n la tabla de distancias de visibilidad, ¬øa qu√© distancia se puede ver a un peat√≥n con ropas claras si se utilizan las luces bajas?", options: ["25 metros.", "60 metros.", "125 metros."], correct: 1 },
        { question: "Utilizando las luces altas, ¬øa qu√© distancia se puede ver a un peat√≥n con ropas claras?", options: ["150 metros.", "450 metros.", "300 metros."], correct: 2 },
        { question: "¬øCu√°ndo es obligatorio por ley que los veh√≠culos circulen con sus luces encendidas?", options: ["Solo durante la noche en v√≠as rurales.", "Desde media hora despu√©s de la puesta de sol hasta media hora antes de su salida, y cuando la visibilidad no sea buena.", "√önicamente desde la medianoche hasta el amanecer."], correct: 1 },
        { question: "En v√≠as interurbanas, ¬øcu√°l es la normativa sobre el uso de luces durante el d√≠a?", options: ["Se deben usar solo si est√° nublado.", "Se debe circular siempre con las luces encendidas.", "Est√° prohibido usar luces durante el d√≠a."], correct: 1 },
        { question: "Al encontrarse de noche con otro veh√≠culo en una v√≠a no urbana, ¬øhacia d√≥nde se recomienda dirigir la mirada para no ser encandilado?", options: ["Directamente a los focos del otro veh√≠culo.", "Hacia el borde derecho de la calzada.", "Hacia el espejo retrovisor interior."], correct: 1 },
        { question: "Al cruzarse con un bus o cami√≥n en un cambio de rasante, ¬øpor qu√© se debe cambiar a luces bajas con mayor anticipaci√≥n?", options: ["Porque sus luces son menos potentes y necesitan m√°s ayuda.", "Porque sus conductores van sentados a una mayor altura.", "Porque los buses y camiones no tienen luces bajas."], correct: 1 },
        { question: "Al adelantar a otro veh√≠culo de noche, ¬øcu√°ndo se deben cambiar las luces de bajas a altas?", options: ["Solo despu√©s de haber completado el adelantamiento.", "Tan pronto tenga seguridad de no cegar al conductor del veh√≠culo que va adelante.", "No se deben usar las luces altas durante un adelantamiento."], correct: 1 },
        { question: "Cuando otro veh√≠culo te est√° adelantando de noche, ¬øc√≥mo puedes ayudar a quien realiza la maniobra?", options: ["Cambiando a luces bajas inmediatamente.", "Conduciendo con luces altas tanto como sea posible y bajarlas cuando el veh√≠culo aparezca oblicuamente a la izquierda.", "Apagando las luces para evitar cualquier reflejo."], correct: 1 },
        { question: "Al estacionar en una v√≠a p√∫blica sin alumbrado, adem√°s de las luces de estacionamiento, ¬øqu√© otra acci√≥n se puede realizar para ser m√°s visible?", options: ["Tocar la bocina intermitentemente.", "Encender la iluminaci√≥n interna del veh√≠culo.", "Abrir las puertas del veh√≠culo."], correct: 1 },
        { question: "¬øQu√© luces deben tener en su parte delantera las motocicletas y motonetas?", options: ["Dos focos que proyecten luces altas y bajas.", "Un foco que proyecta luces altas y bajas.", "Un foco de luz amarilla y dos de viraje."], correct: 1 },
        { question: "¬øQu√© tipo de luces deben llevar los veh√≠culos a tracci√≥n animal?", options: ["Huinchas retrorreflectantes en los costados.", "Un farol en cada costado que proyecte luz blanca hacia adelante y roja hacia atr√°s.", "No requieren ning√∫n tipo de iluminaci√≥n."], correct: 1 },
        { question: "¬øDe qu√© color son las luces que los veh√≠culos proyectan hacia atr√°s?", options: ["Siempre son rojas.", "Son rojas, con excepci√≥n de las de retroceso (blancas) y las de viraje (rojas o amarillas).", "Son blancas o amarillas."], correct: 1 },
        { question: "¬øQu√© efecto tiene una carga pesada en la parte delantera de un autom√≥vil?", options: ["El veh√≠culo tender√° a girar m√°s de lo esperado.", "El veh√≠culo tender√° a girar menos.", "No tiene ning√∫n efecto en la direcci√≥n."], correct: 1 },
        { question: "¬øCu√°l es la recomendaci√≥n sobre la carga en la parrilla del techo?", options: ["Se puede cargar sin l√≠mite de peso.", "No sobrecargarla, considerando la estabilidad del veh√≠culo y la resistencia del techo.", "La carga en la parrilla no afecta la estabilidad."], correct: 1 },
        { question: "¬øQu√© permiso de conducci√≥n se necesita para llevar un remolque ligero cuyo peso no exceda la tara del veh√≠culo motriz?", options: ["Se necesita una licencia especial para remolques.", "La Licencia de Conducir Clase B es suficiente, siempre que el peso total no supere los 3.500 kg.", "Se necesita una licencia profesional Clase A."], correct: 1 },
        { question: "¬øQu√© sucede cuando la presi√≥n sobre la esfera de enganche de un remolque es baja o nula?", options: ["La parte trasera del autom√≥vil se ve cargada hacia abajo.", "El veh√≠culo entero comienza a serpentear y el remolque puede voltear.", "Mejora la adherencia de las ruedas traseras."], correct: 1 },
        { question: "Antes de conducir con un remolque, ¬øqu√© se debe verificar en relaci√≥n a las conexiones?", options: ["Que las conexiones de luces y frenos el√©ctricos est√©n bien enchufadas.", "Solo se debe verificar la conexi√≥n de las luces.", "Las conexiones no necesitan verificaci√≥n si se usan poco."], correct: 0 },
        { question: "¬øQu√© debe hacer un conductor que va por la autopista para facilitar el acceso a los veh√≠culos que van a entrar?", options: ["Acelerar para pasar antes que ellos.", "Aligerar la presi√≥n sobre el acelerador, dejar pasar o cambiarse de pista si es seguro.", "Mantener su velocidad y pista sin hacer cambios."], correct: 1 },
        { question: "¬øCu√°l es un riesgo de conducir de forma mon√≥tona en carreteras buenas y r√°pidas?", options: ["Que el conductor se canse f√°cilmente o le pueda dar sue√±o.", "Un aumento en la atenci√≥n del conductor.", "Un menor consumo de combustible."], correct: 0 },
        { question: "¬øEn qu√© situaciones est√° permitido detenerse en una autopista?", options: ["Para recoger o dejar pasajeros.", "Solo si se produce una emergencia o lo solicita Carabineros.", "En cualquier berma para descansar."], correct: 1 },
        { question: "Si el veh√≠culo sufre una falla mec√°nica en la berma de una autopista, ¬øpor qu√© puerta deben salir los ocupantes?", options: ["Por la puerta del conductor para tener mejor visibilidad.", "Por la puerta derecha, asegur√°ndose que todos los pasajeros hagan lo mismo.", "No deben salir del veh√≠culo bajo ninguna circunstancia."], correct: 1 },
        { question: "Al salir de una autopista, ¬øpor qu√© es importante controlar la velocidad mirando el veloc√≠metro?", options: ["Porque la velocidad puede ser mayor de lo que se cree.", "Porque las v√≠as de salida no tienen l√≠mite de velocidad.", "Porque los veloc√≠metros tienden a fallar despu√©s de conducir a alta velocidad."], correct: 0 },
        { question: "¬øQu√© indican las balizas de acercamiento con las marcas 300 m, 200 m y 100 m?", options: ["La distancia a la pr√≥xima estaci√≥n de servicio.", "La distancia al inicio de una pista de desaceleraci√≥n para abandonar una autopista.", "La distancia para el pr√≥ximo peaje."], correct: 1 },
        { question: "Al circular por un t√∫nel, ¬øqu√© se debe hacer con las ventanas y la ventilaci√≥n?", options: ["Abrir las ventanas para que circule el aire.", "Cerrar las ventanas y poner en funcionamiento el sistema de ventilaci√≥n.", "Es irrelevante, no requiere ninguna acci√≥n especial."], correct: 1 },
        { question: "En caso de incendio del veh√≠culo dentro de un t√∫nel, ¬øcu√°l es la primera acci√≥n a tomar si es posible?", options: ["Abandonar el veh√≠culo inmediatamente en medio del t√∫nel.", "Salir del t√∫nel con el veh√≠culo.", "Esperar dentro del veh√≠culo por asistencia."], correct: 1 },
        { question: "Al conducir con lluvia, ¬øcu√°l es la recomendaci√≥n para secar los frenos si pierden eficacia al mojarse?", options: ["Acelerar para que se sequen con el viento.", "Pisar ligera y suavemente el pedal de freno en forma repetida (efecto bombeo).", "Detenerse y esperar a que se sequen solos."], correct: 1 },
        { question: "¬øCu√°nto puede aumentar la distancia de frenado con lluvia?", options: ["No aumenta, se mantiene igual que en condiciones secas.", "Puede ser a lo menos el doble que en condiciones ideales.", "Aumenta en un 10%."], correct: 1 },
        { question: "¬øCu√°l es el mejor consejo para evitar el 'aquaplaning'?", options: ["Aumentar la velocidad para pasar r√°pidamente sobre el agua.", "Moderar la velocidad para que los neum√°ticos puedan desalojar el agua.", "Frenar bruscamente al ver una capa de agua."], correct: 1 },
        { question: "Si es inevitable pasar por un tramo inundado, ¬øc√≥mo se debe circular?", options: ["R√°pidamente para evitar que el agua entre al motor.", "Lentamente en primera y a velocidad constante.", "En punto muerto para ahorrar combustible."], correct: 1 },
        { question: "Al conducir con nieve, ¬øc√≥mo se deben utilizar los componentes del veh√≠culo como frenos, acelerador y direcci√≥n?", options: ["Con movimientos bruscos para asegurar la tracci√≥n.", "Con extrema delicadeza y suavidad.", "De la misma forma que en pavimento seco."], correct: 1 },
        { question: "Al subir una pendiente con nieve, ¬øc√≥mo se debe proceder para evitar el derrape?", options: ["Tratar de recuperar la velocidad perdida r√°pidamente.", "Subir lentamente y a velocidad sostenida.", "Detenerse a la mitad para que los neum√°ticos se agarren mejor."], correct: 1 },
        { question: "¬øQu√© indicio en la direcci√≥n del veh√≠culo puede se√±alar la presencia de hielo en la calzada?", options: ["Si la direcci√≥n se siente excesivamente pesada.", "Si la direcci√≥n del veh√≠culo est√° excesivamente ligera, como si flotara.", "Si la direcci√≥n vibra constantemente."], correct: 1 },
        { question: "En condiciones de niebla, ¬øqu√© luces se deben usar para ser m√°s visible y por qu√©?", options: ["Luces altas, porque tienen m√°s potencia.", "Luces bajas, porque al proyectarse hacia el suelo se ven m√°s y mejor.", "Solo las luces de emergencia."], correct: 1 },
        { question: "¬øCu√°ndo se deben utilizar las luces de niebla traseras?", options: ["Siempre que haya un poco de niebla.", "Solo cuando la niebla es espesa, para no deslumbrar a quienes circulan atr√°s.", "Nunca, porque son peligrosas."], correct: 1 },
        { question: "Ante r√°fagas de viento fuerte, ¬øqu√© precauci√≥n adicional se debe tener con los motociclistas y ciclistas?", options: ["Acercarse a ellos para cortarles el viento.", "Mantener una distancia lateral segura, ya que podr√≠an tambalear o desviarse.", "Tocar la bocina para que se detengan."], correct: 1 },
        { question: "Adem√°s de reducir costos, ¬øcu√°l es otro beneficio importante de la conducci√≥n eficiente mencionado en el texto?", options: ["Permite llegar m√°s r√°pido al destino.", "Brinda seguridad a las dem√°s personas usuarias de las v√≠as y reduce la contaminaci√≥n.", "Aumenta la vida √∫til del motor a costa de otros componentes."], correct: 1 },
        { question: "¬øCu√°l es la recomendaci√≥n sobre los viajes y tr√°mites para una conducci√≥n eficiente?", options: ["Realizar cada tr√°mite en un viaje separado para no sobrecargar el veh√≠culo.", "Reunir varios tr√°mites en un mismo viaje para evitar recorridos innecesarios.", "Utilizar siempre la ruta m√°s larga para disfrutar del viaje."], correct: 1 },
        { question: "¬øQu√© se recomienda hacer con objetos de peso como cajas de herramientas cuando no son necesarios para un viaje?", options: ["Dejarlos en el veh√≠culo por si se necesitan.", "Guardarlos en otro lugar para no a√±adir peso innecesario y aumentar el consumo.", "Ponerlos en el techo para equilibrar el peso."], correct: 1 },
        { question: "¬øD√≥nde se puede encontrar la informaci√≥n sobre la presi√≥n de aire correcta para los neum√°ticos?", options: ["Solo en el manual del veh√≠culo.", "En el manual del veh√≠culo o en el marco de la puerta del conductor.", "Est√° escrita en el propio neum√°tico."], correct: 1 },
        { question: "¬øCon qu√© frecuencia se recomienda revisar la presi√≥n de los neum√°ticos?", options: ["Una vez al a√±o.", "En la frecuencia descrita por el fabricante o al menos cada dos semanas.", "Solo antes de viajes largos."], correct: 1 },
        { question: "¬øC√≥mo puede perjudicar el rendimiento un filtro de aire sucio?", options: ["Puede perjudicarlo en un 1,5%, ya que el combustible no se utiliza en un 100%.", "Puede mejorar el rendimiento al filtrar mejor las impurezas.", "No afecta el rendimiento, solo la calidad del aire en la cabina."], correct: 0 },
        { question: "¬øPor qu√© se recomienda evitar las aceleraciones 'a fondo'?", options: ["Porque generan un consumo excesivo de combustible.", "Porque pueden da√±ar la caja de cambios.", "Porque no permiten alcanzar la velocidad m√°xima."], correct: 0 },
        { question: "A altas velocidades, como 120 km/h, ¬øqu√© sucede con el rendimiento del combustible?", options: ["Se optimiza y es el m√°s eficiente.", "Se reduce bastante, del orden de un 10% y m√°s.", "No sufre ninguna variaci√≥n importante."], correct: 1 },
        { question: "En un veh√≠culo con caja de cambios autom√°tica, ¬øqu√© sucede si se presiona el acelerador a fondo?", options: ["El veh√≠culo selecciona la marcha m√°s alta posible para ahorrar combustible.", "El veh√≠culo puede seleccionar marchas m√°s bajas para incrementar la potencia, lo que aumenta el consumo.", "El veh√≠culo se pone en modo de conducci√≥n eficiente autom√°ticamente."], correct: 1 },
        { question: "¬øQu√© se logra al frenar con anticipaci√≥n en lugar de hacerlo a √∫ltimo minuto?", options: ["No se gana tiempo y se pierde la oportunidad de ahorrar combustible.", "Se llega m√°s r√°pido al destino.", "Se produce un mayor desgaste de los neum√°ticos."], correct: 0 },
        { question: "En situaciones de emergencia, ¬øqu√© debe primar por sobre la econom√≠a de combustible?", options: ["La rapidez para salir de la situaci√≥n.", "La seguridad, por lo que se pueden obviar algunos consejos de conducci√≥n eficiente.", "El mantener el motor a bajas revoluciones."], correct: 1 },
        { question: "¬øCu√°l es el resultado de la relaci√≥n entre una conducci√≥n segura y una conducci√≥n eficiente?", options: ["Son conceptos opuestos y no se pueden aplicar al mismo tiempo.", "Una conducci√≥n segura es la base para una conducci√≥n eficiente.", "Una conducci√≥n eficiente pone en riesgo la seguridad."], correct: 1 },
        { question: "¬øCu√°l es el ID del elemento contenedor principal?", options: ["main-container", "container", "exam-wrapper"], correct: 1 },
        { question: "¬øQu√© efecto de estilo CSS se aplica cuando el cursor pasa sobre el bot√≥n de reinicio del examen (`#reset-exam-btn`)?", options: ["El fondo cambia a rojo y el √≠cono parpadea.", "El fondo cambia a `#e2e8f0` y el √≠cono rota 90 grados.", "El bot√≥n se agranda un 20%."], correct: 1 },
        { question: "En el simulador de examen, ¬øqu√© clase CSS se aplica a una opci√≥n de respuesta seleccionada que es correcta?", options: [".selected", ".correct", ".answer-right"], correct: 1 },
        { question: "En el simulador de examen, ¬øcu√°l es el tiempo de duraci√≥n preseleccionado en el men√∫ desplegable al iniciar la aplicaci√≥n?", options: ["30 Minutos.", "15 Minutos.", "60 Minutos."], correct: 1 },
        { question: "¬øCu√°l es el ID del bot√≥n que da inicio al examen en la pantalla de bienvenida?", options: ["start-exam-button", "start-btn", "begin-test"], correct: 1 },
        { question: "¬øCu√°l es el prop√≥sito de la funci√≥n `shuffleArray(array)`?", options: ["Ordenar los elementos de un array alfab√©ticamente.", "Mezclar aleatoriamente los elementos de un array.", "Eliminar los elementos duplicados de un array."], correct: 1 },
        { question: "¬øQu√© hace la funci√≥n `randomizeQuestionOptions()` antes de comenzar el examen?", options: ["Mezcla el orden de las preguntas y tambi√©n el orden de las opciones de cada pregunta.", "Solo mezcla el orden de las preguntas.", "Solo elige preguntas al azar del banco de preguntas."], correct: 0 },
        { question: "¬øQu√© valor se almacena en el array `userAnswers` para una pregunta que a√∫n no ha sido respondida?", options: ["undefined", "null", "0"], correct: 1 },
        { question: "¬øQu√© sucede si un usuario intenta seleccionar una opci√≥n en una pregunta que ya ha sido respondida?", options: ["La nueva respuesta reemplaza a la anterior.", "La funci√≥n `selectOption` no hace nada, impidiendo el cambio de respuesta.", "Se muestra una alerta indicando que la pregunta ya fue contestada."], correct: 1 },
        { question: "Si el usuario llega a la √∫ltima pregunta, ¬øqu√© texto muestra el bot√≥n 'Siguiente'?", options: ["'Siguiente ‚Üí'", "'Finalizar Examen'", "'Ver Resultados'"], correct: 1 },
        { question: "¬øQu√© ocurre si el tiempo del temporizador llega a cero?", options: ["El examen se reinicia autom√°ticamente.", "Se detiene el intervalo del temporizador y se muestran los resultados con el t√≠tulo '¬°Se acab√≥ el tiempo!'.", "El usuario tiene 1 minuto extra para terminar."], correct: 1 },
        { question: "¬øCu√°l es el porcentaje de aprobaci√≥n (`passMark`) definido en el c√≥digo para considerar un examen como 'Aprobado'?", options: ["75%", "85%", "90%"], correct: 1 },
        { question: "¬øEn qu√© caso se muestra la secci√≥n de revisi√≥n de respuestas incorrectas (`review-section`)?", options: ["Siempre, independientemente del resultado.", "Solo si hay una o m√°s respuestas incorrectas.", "Solo si el examen es reprobado."], correct: 1 },
        { question: "¬øQu√© acci√≥n realiza el bot√≥n con el ID `restart-btn` en la pantalla de resultados?", options: ["Permite revisar las respuestas incorrectas nuevamente.", "Detiene el temporizador y muestra la pantalla de inicio, reiniciando el estado del examen.", "Solo reinicia el temporizador, manteniendo las mismas preguntas y respuestas."], correct: 1 },
        { question: "¬øQu√© le sucede al texto de progreso (`progress-text`) a medida que avanza el examen?", options: ["Muestra el porcentaje de avance.", "Muestra el texto 'Pregunta [n√∫mero actual] de [total de preguntas]'.", "Muestra las respuestas correctas e incorrectas."], correct: 1 },
        { question: "¬øQu√© ocurre si el banco de preguntas (`let questions = []`) est√° vac√≠o al cargar la p√°gina?", options: ["El examen comienza con preguntas de ejemplo.", "El bot√≥n de 'Comenzar Examen' se deshabilita y se muestra un mensaje indicando que no hay preguntas.", "La p√°gina muestra un error y no carga."], correct: 1 },
        { question: "¬øQu√© clase CSS se a√±ade a un bot√≥n de opci√≥n para evitar que el usuario pueda hacer clic en √©l despu√©s de haber respondido?", options: [".locked", ".disabled", ".answered"], correct: 1 },
        { question: "En la secci√≥n de revisi√≥n de respuestas, ¬øqu√© informaci√≥n se muestra para cada pregunta incorrecta?", options: ["Solo la respuesta correcta.", "El n√∫mero y texto de la pregunta, la respuesta del usuario y la respuesta correcta.", "Solo el n√∫mero de la pregunta y la respuesta del usuario."], correct: 1 },
        { question: "¬øCu√°l es la funci√≥n del elemento con el ID `progress-fill`?", options: ["Es una barra que se llena para representar visualmente el progreso del examen.", "Muestra el tiempo restante en formato de barra.", "Es un texto que indica el porcentaje de progreso."], correct: 0 }
    ];
    // --- VARIABLES GLOBALES ---
    let currentQuestionIndex;
    let userAnswers;
    let timerInterval;
    let shuffledQuestions = [];
    let passMark; // NUEVO

    // --- ELEMENTOS DEL DOM ---
    const startScreen = document.getElementById('start-screen');
    const examScreen = document.getElementById('exam-screen');
    const resultsScreen = document.getElementById('results-screen');
    const startBtn = document.getElementById('start-btn');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const restartBtn = document.getElementById('restart-btn');
    const resetExamBtn = document.getElementById('reset-exam-btn');
    const timeSelect = document.getElementById('time-select');
    const passMarkSelect = document.getElementById('pass-mark-select'); // NUEVO
    const startText = document.getElementById('start-text');
    const timerDisplay = document.getElementById('timer-display');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const resultsTitle = document.getElementById('results-title');
    const correctCountEl = document.getElementById('correct-count');
    const incorrectCountEl = document.getElementById('incorrect-count');
    const totalCountEl = document.getElementById('total-count');
    const finalScoreEl = document.getElementById('final-score');
    const examStatusEl = document.getElementById('exam-status');
    const reviewSection = document.getElementById('review-section');
    const incorrectAnswersList = document.getElementById('incorrect-answers-list');
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body; 

    // --- FUNCIONES ---

    function toggleTheme() {
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            localStorage.setItem('theme', 'light-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark-mode') {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            body.classList.remove('dark-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function randomizeQuestionOptions() {
        shuffledQuestions = JSON.parse(JSON.stringify(questions));
        shuffledQuestions.forEach(q => {
            const correctAnswerText = q.options[q.correct];
            shuffleArray(q.options);
            const newCorrectIndex = q.options.findIndex(option => option === correctAnswerText);
            q.correct = newCorrectIndex;
        });
    }

    function initializeApp() {
        if (questions.length > 0) {
            startText.textContent = `Prep√°rate con ${questions.length} preguntas.`;
            startBtn.disabled = false;
        } else {
            startText.textContent = 'No hay preguntas cargadas. Agrega preguntas en el array "questions" para comenzar.';
            startBtn.disabled = true;
        }
        startBtn.addEventListener('click', startExam);
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', prevQuestion);
        restartBtn.addEventListener('click', restartExam);
        resetExamBtn.addEventListener('click', restartExam);
        themeToggle.addEventListener('click', toggleTheme);
        loadTheme();
    }

    function startExam() {
      randomizeQuestionOptions();
      currentQuestionIndex = 0;
      userAnswers = new Array(shuffledQuestions.length).fill(null);
      startScreen.classList.add('hidden');
      resultsScreen.classList.add('hidden');
      examScreen.classList.remove('hidden');
      reviewSection.classList.add('hidden');
      
      // NUEVO: Capturar el valor de la nota de aprobaci√≥n
      passMark = parseInt(passMarkSelect.value, 10);
      
      const durationMinutes = parseInt(timeSelect.value, 10);
      startTimer(durationMinutes);
      showQuestion();
    }
    
    function showQuestion() {
        const q = shuffledQuestions[currentQuestionIndex];
        if (!q) return; 

        updateProgress();
        questionNumberEl.textContent = `Pregunta ${currentQuestionIndex + 1}`;
        questionTextEl.textContent = q.question;
        optionsContainer.innerHTML = '';
        const answered = userAnswers[currentQuestionIndex] !== null;
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option';
            btn.innerHTML = `<span class="option-letter">${String.fromCharCode(65 + idx)}</span>${opt}`;
            btn.onclick = () => selectOption(idx);
            
            if (answered) {
               btn.classList.add('disabled');
                if (idx === q.correct) {
                    btn.classList.add('correct');
                } else if (idx === userAnswers[currentQuestionIndex]) {
                    btn.classList.add('incorrect');
                 }
            }
            optionsContainer.appendChild(btn);
        });
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.textContent = (currentQuestionIndex === shuffledQuestions.length - 1) ? 'Finalizar Examen' : 'Siguiente ‚Üí';
    }

    function selectOption(selectedIndex) {
      if (userAnswers[currentQuestionIndex] !== null) return; 
      userAnswers[currentQuestionIndex] = selectedIndex;
      showQuestion();
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < shuffledQuestions.length - 1) {
        currentQuestionIndex++;
        showQuestion();
      } else {
        showResults("¬°Examen Completado!");
      }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            showQuestion();
        }
    }

    function showResults(title) {
        clearInterval(timerInterval);
        examScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        resultsTitle.textContent = title;
        const correctCount = userAnswers.filter((answer, index) => answer === shuffledQuestions[index].correct).length;
        const totalAnswered = userAnswers.filter(answer => answer !== null).length;
        const incorrectCount = totalAnswered - correctCount;
        const score = shuffledQuestions.length > 0 ? Math.round((correctCount / shuffledQuestions.length) * 100) : 0;
        
        correctCountEl.textContent = correctCount;
        incorrectCountEl.textContent = incorrectCount;
        totalCountEl.textContent = shuffledQuestions.length;
        finalScoreEl.textContent = `${score}%`;

        // NUEVO: Usar la variable 'passMark' en lugar de un valor fijo
        if (score >= passMark) {
            examStatusEl.textContent = 'Aprobado';
            examStatusEl.className = 'score-value status passed';
        } else {
            examStatusEl.textContent = 'Reprobado';
            examStatusEl.className = 'score-value status failed';
        }
        
        displayIncorrectAnswers();
    }

    function displayIncorrectAnswers() {
        incorrectAnswersList.innerHTML = '';
        const incorrectAnswers = [];

        userAnswers.forEach((answer, index) => {
            if (answer !== null && answer !== shuffledQuestions[index].correct) {
                const q = shuffledQuestions[index];
                incorrectAnswers.push({
                    questionNumber: index + 1,
                    question: q.question,
                    userAnswer: q.options[answer],
                    correctAnswer: q.options[q.correct]
                });
            }
        });
        if (incorrectAnswers.length > 0) {
            reviewSection.classList.remove('hidden');
            incorrectAnswers.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'incorrect-answer-item';
                itemEl.innerHTML = `
                    <p><strong>Pregunta ${item.questionNumber}:</strong> ${item.question}</p>
                    <p class="user-answer"><strong>Tu respuesta:</strong> ${item.userAnswer}</p>
                    <p class="correct-answer"><strong>Respuesta correcta:</strong> ${item.correctAnswer}</p>
                `;
                incorrectAnswersList.appendChild(itemEl);
            });
        } else {
            reviewSection.classList.add('hidden');
        }
    }

    function restartExam() {
        clearInterval(timerInterval);
        startScreen.classList.remove('hidden');
        examScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        reviewSection.classList.add('hidden');
        initializeApp(); // Re-inicializamos para verificar si hay preguntas
    }

    function startTimer(minutes) {
        let timeInSeconds = minutes * 60;
        timerInterval = setInterval(() => {
            if (timeInSeconds <= 0) {
                clearInterval(timerInterval);
                timerDisplay.textContent = "00:00";
                showResults("¬°Se acab√≥ el tiempo!");
                return;
               }

            timeInSeconds--;
            const remMinutes = Math.floor(timeInSeconds / 60);
            const remSeconds = timeInSeconds % 60;
            timerDisplay.textContent = `${String(remMinutes).padStart(2, '0')}:${String(remSeconds).padStart(2, '0')}`;
        }, 1000);
    }
    
    function updateProgress() {
      const percentage = shuffledQuestions.length > 0 ?
      ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100 : 0;
      progressFill.style.width = percentage + '%';
      progressText.textContent = `Pregunta ${currentQuestionIndex + 1} de ${shuffledQuestions.length}`;
    }

    // --- INICIAR APP ---
    initializeApp();
});
</script>
</body>
</html>