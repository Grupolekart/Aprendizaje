<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Examen</title>
  <style>
    :root {
      /* --- Variables de Color Modo Claro (Default) --- */
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --container-bg: rgba(255, 255, 255, .95);
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --border-color: #e2e8f0;
      --card-bg: #fff;
      --button-bg: #f7fafc;
      --button-hover-bg: #edf2f7;
      --button-secondary-bg: #e2e8f0;
      --button-secondary-hover-bg: #cbd5e0;
      --correct-bg: #e6fffa;
      --correct-border: #38a169;
      --correct-text: #2f855a;
      --incorrect-bg: #fff5f5;
      --incorrect-border: #e53e3e;
      --incorrect-text: #c53030;
    }

    .dark-mode {
      /* --- Variables de Color Modo Oscuro --- */
      --bg-gradient-start: #1a202c;
      --bg-gradient-end: #2d3748;
      --container-bg: rgba(45, 55, 72, .95);
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5e0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --card-bg: #2d3748;
      --button-bg: #4a5568;
      --button-hover-bg: #2d3748;
      --button-secondary-bg: #4a5568;
      --button-secondary-hover-bg: #718096;
      --correct-bg: #2f855a;
      --correct-border: #38a169;
      --correct-text: #e6fffa;
      --incorrect-bg: #c53030;
      --incorrect-border: #e53e3e;
      --incorrect-text: #fff5f5;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--text-primary);
      transition: background .3s ease;
    }
    .container {
      background: var(--container-bg);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      padding: 40px;
      transition: all .3s ease;
      position: relative;
    }
    /* --- BOT√ìN DE MODO D√çA/NOCHE --- */
    #theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    #theme-toggle:hover {
        background: var(--button-secondary-hover-bg);
        transform: scale(1.1) rotate(15deg);
    }

    .main-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }
    .main-header-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-secondary);
    }
    .header { text-align: center; margin-bottom: 30px; }
    .title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; color: var(--text-primary); }
    .subtitle { color: var(--text-muted); font-size: 1.1rem; }
    
    .timer-setup { margin: 20px 0; text-align: center; } /* Reducido el margen vertical */
    .timer-setup label { font-weight: 600; margin-right: 10px; font-size: 1.1rem; color: var(--text-secondary); }
    .timer-setup select {
        padding: 8px 12px;
        border-radius: 8px;
        border: 2px solid var(--border-color);
        background-color: var(--button-bg);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
    }
    .exam-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
    }
    #timer-display {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--bg-gradient-end);
        background: var(--button-bg);
        padding: 5px 15px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }
    #reset-exam-btn {
        position: absolute;
        top: -20px;
        right: -20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    #reset-exam-btn:hover { background: var(--button-secondary-hover-bg); transform: rotate(90deg); }

    .progress-container { margin-bottom: 30px; }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--bg-gradient-start), var(--bg-gradient-end));
      border-radius: 10px;
      transition: width .3s ease;
    }
    .progress-text { text-align: center; color: var(--text-secondary); font-weight: 600; }
    .question-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.06);
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
    }
    .question-number { color: var(--bg-gradient-start); font-size: .9rem; font-weight: 600; margin-bottom:15px; }
    .question-text { font-size:1.3rem; line-height:1.6; font-weight:600; margin-bottom:25px; color: var(--text-primary); }
    .options { display:grid; gap:12px; }
    .option {
      background:var(--button-bg);
      border:2px solid var(--border-color);
      border-radius:12px;
      padding:18px 20px;
      cursor:pointer;
      transition:all .2s ease;
      display:flex;
      align-items:center;
      font-size:1rem;
      color:var(--text-secondary);
      text-align: left;
    }
    .option:hover:not(.disabled) {
      border-color:var(--bg-gradient-start);
      background:var(--button-hover-bg);
      transform:translateY(-2px);
      box-shadow:0 4px 20px rgba(102,126,234,0.15);
    }
    .option.disabled { pointer-events:none; }
    .option.correct { border-color:var(--correct-border)!important; background:var(--correct-bg)!important; color:var(--correct-text)!important; }
    .option.incorrect { border-color:var(--incorrect-border)!important; background:var(--incorrect-bg)!important; color:var(--incorrect-text)!important; }
    .option-letter {
      background:var(--bg-gradient-start);
      color:white;
      width:30px;
      height:30px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      margin-right:15px;
      font-size:.9rem;
      flex-shrink: 0;
    }
    .navigation { display:flex; justify-content:space-between; align-items:center; margin-top:30px; }
    .btn {
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color:white;
      border:none;
      padding:12px 24px;
      border-radius:12px;
      cursor:pointer;
      font-size:1rem;
      font-weight:600;
      transition:all .3s ease;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn-secondary { background: var(--button-secondary-bg); color: var(--text-secondary); }
    .btn-secondary:hover:not(:disabled) { background: var(--button-secondary-hover-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .btn:hover:not(:disabled) {
      transform:translateY(-2px);
      box-shadow:0 8px 25px rgba(102,126,234,0.3);
    }
    .btn:disabled { opacity:.5; cursor:not-allowed; transform:none; box-shadow: none;}
    .hidden { display:none; }
    
    .results { text-align:center; padding:40px 20px; }
    .results h2 { font-size:2.2rem; margin-bottom:20px; color: var(--text-primary); }
    .score {
      font-size:4rem;
      font-weight:800;
      margin:30px 0;
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .score-details {
      background: var(--button-bg);
      border-radius:16px;
      padding:25px;
      margin:30px 0;
      border:1px solid var(--border-color);
    }
    .score-item { display:flex; justify-content:space-between; margin:10px 0; font-size:1.1rem; }
    .score-label { color: var(--text-secondary); }
    .score-value { font-weight:600; color: var(--text-primary); }
    .status.passed { color:#38a169; }
    .status.failed { color:#e53e3e; }

    #review-section h3 {
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
    }
    .incorrect-answer-item {
        background: var(--incorrect-bg);
        border: 1px solid var(--incorrect-border);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        text-align: left;
    }
    .incorrect-answer-item p { margin-bottom: 8px; line-height: 1.5; color: var(--text-primary); }
    .incorrect-answer-item .user-answer { color: var(--incorrect-text); }
    .incorrect-answer-item .correct-answer { color: var(--correct-text); font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <button id="theme-toggle" title="Cambiar Tema">üåì</button>
    <div class="main-header">
        <h2 class="main-header-title">Factores Humanos y Seguridad en la Conducci√≥n</h2>
    </div>

    <div id="start-screen">
      <div class="header">
        <h1 class="title">üìù Simulador de Examen</h1>
        <p class="subtitle">Pon a prueba tus conocimientos</p>
      </div>
      <div class="timer-setup">
          <label for="time-select">Selecciona el tiempo:</label>
          <select id="time-select">
              <option value="15" selected>15 Minutos</option>
              <option value="20">20 Minutos</option>
              <option value="25">25 Minutos</option>
              <option value="30">30 Minutos</option>
              <option value="35">35 Minutos</option>
              <option value="40">40 Minutos</option>
              <option value="45">45 Minutos</option>
              <option value="50">50 Minutos</option>
              <option value="55">55 Minutos</option>
              <option value="60">60 Minutos</option>
          </select>
      </div>

      <div class="timer-setup">
          <label for="pass-mark-select">Nota de Aprobaci√≥n:</label>
          <select id="pass-mark-select">
              <option value="50">50%</option>
              <option value="60">60%</option>
              <option value="70">70%</option>
              <option value="80">80%</option>
              <option value="85" selected>85%</option>
              <option value="90">90%</option>
              <option value="100">100%</option>
          </select>
      </div>
      <div style="text-align:center;">
         <p id="start-text" style="margin:20px 0;color: var(--text-muted);font-size:1.1rem;"></p>
        <button id="start-btn" class="btn">üöÄ Comenzar Examen</button>
      </div>
    </div>

    <div id="exam-screen" class="hidden">
      <button id="reset-exam-btn" title="Reiniciar Examen">üîÑ</button>
       <div class="exam-header">
         <h2 style="color: var(--text-muted);">Examen en Curso</h2>
         <div id="timer-display">--:--</div>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
           <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text"></div>
      </div>
      <div class="question-card">
        <div class="question-number" id="question-number"></div>
        <div class="question-text" id="question-text"></div>
        <div class="options" id="options"></div>
      </div>
      <div class="navigation">
        <button class="btn btn-secondary" id="prev-btn">‚Üê Anterior</button>
         <button class="btn" id="next-btn">Siguiente ‚Üí</button>
      </div>
    </div>

    <div id="results-screen" class="hidden">
      <div class="results">
        <h2 id="results-title">¬°Examen Completado!</h2>
        <div class="score" id="final-score"></div>
        <div class="score-details">
          <div class="score-item">
            <span class="score-label">Respuestas correctas:</span>
            <span class="score-value" id="correct-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Respuestas incorrectas:</span>
            <span class="score-value" id="incorrect-count"></span>
          </div>
          <div class="score-item">
            <span class="score-label">Total de preguntas:</span>
            <span class="score-value" id="total-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Estado:</span>
            <span class="score-value status" id="exam-status"></span>
          </div>
        </div>
        <button id="restart-btn" class="btn">üîÑ Reiniciar Examen</button>

        <div id="review-section" class="hidden" style="margin-top: 40px;">
            <h3>Revisi√≥n de Respuestas Incorrectas</h3>
            <div id="incorrect-answers-list" style="margin-top: 20px;"></div>
        </div>
      </div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', () => {
    // --- BANCO DE PREGUNTAS ---
    let questions = [
        { question: "¬øPor qu√© es riesgoso realizar actividades simult√°neas mientras conduces?", options: ["Porque mejora la capacidad de reacci√≥n al mantener la mente ocupada.", "Porque desv√≠a la atenci√≥n, aumenta la posibilidad de perder el control del veh√≠culo y dificulta enfrentar situaciones imprevistas.", "Porque solo reduce el confort del viaje sin afectar la seguridad."], correct: 1 },
        { question: "¬øQu√© fen√≥meno describe el hecho de percibir visualmente solo aquello que se espera encontrar?", options: ["Percepci√≥n selectiva.", "Agudeza visual.", "Memoria sensorial."], correct: 0 },
        { question: "¬øQu√© sucede con la pupila del ojo humano en condiciones de oscuridad?", options: ["Se contrae para evitar deslumbramiento.", "Aumenta su tama√±o para permitir la entrada de m√°s luz.", "Mantiene un tama√±o constante gracias al cristalino."], correct: 1 },
        { question: "¬øQu√© tipo de visi√≥n es esencial para reconocer objetos en detalle durante la conducci√≥n?", options: ["Visi√≥n perif√©rica.", "Visi√≥n nocturna.", "Visi√≥n directa."], correct: 2 },
        { question: "¬øPor qu√© ocurre la subestimaci√≥n de la velocidad al conducir veh√≠culos modernos?", options: ["Porque los veloc√≠metros digitales muestran menos cifras.", "Porque estos veh√≠culos son m√°s silenciosos y sin vibraciones, dificultando advertir correctamente la velocidad.", "Porque el parabrisas m√°s inclinado genera una ilusi√≥n √≥ptica de lentitud."], correct: 1 },
        { question: "¬øQu√© ocurre con el campo visual cuando aumenta la velocidad al conducir?", options: ["Se produce ‚Äúvisi√≥n de t√∫nel‚Äù, reduciendo el campo visual y la percepci√≥n lateral.", "El campo visual se ampl√≠a por la adrenalina.", "El campo visual se mantiene constante gracias a la visi√≥n perif√©rica."], correct: 0 },
        { question: "¬øCu√°l es la raz√≥n principal por la cual las personas j√≥venes suelen tener mayores riesgos al conducir?", options: ["Por su mejor tiempo de reacci√≥n.", "Por falta de experiencia, actitud poco prudente y baja percepci√≥n del riesgo.", "Porque los autos que usan son m√°s antiguos y fallan m√°s."], correct: 1 },
        { question: "¬øQu√© implica tener responsabilidad al conducir?", options: ["Conducir siempre r√°pido para no obstaculizar.", "Mostrar consideraci√≥n hacia otros, seguir normas y afrontar consecuencias.", "Usar el carril izquierdo de forma preferente para ‚Äúagilizar‚Äù el tr√°nsito."], correct: 1 },
        { question: "¬øQu√© efecto tiene la presi√≥n social sobre las decisiones de conducci√≥n?", options: ["Mejora la prudencia porque hay m√°s vigilancia de pares.", "Puede provocar comportamientos arriesgados por influencia del grupo.", "Solo afecta a conductores novatos, no a experimentados."], correct: 1 },
        { question: "¬øQu√© efectos inmediatos tiene el consumo de alcohol en las capacidades del conductor?", options: ["Mejora la visi√≥n nocturna a corto plazo.", "Reduce visi√≥n perif√©rica, atenci√≥n, tiempo de reacci√≥n e interpretaci√≥n/decisi√≥n.", "Solo afecta la coordinaci√≥n motriz, pero no la interpretaci√≥n de se√±ales."], correct: 1 },
        { question: "¬øCu√°l es el l√≠mite legal en Chile para ser considerado bajo la influencia del alcohol?", options: ["Entre 0.31 y 0.79 g/L de alcohol en sangre.", "Entre 0.05 y 0.30 g/L de alcohol en sangre.", "Entre 0.80 y 1.20 g/L de alcohol en sangre."], correct: 0 },
        { question: "¬øQu√© factores influyen en la tasa de alcohol en la sangre?", options: ["√önicamente el tipo de licor consumido.", "Cantidad ingerida, masa corporal, sexo, tiempo de ingesta, alimentos y bebidas carbonatadas.", "Exclusivamente el metabolismo basal de cada persona."], correct: 1 },
        { question: "¬øPor qu√© es peligroso conducir bajo el efecto de drogas?", options: ["Porque reducen la somnolencia y eso distrae.", "Porque alteran percepci√≥n, atenci√≥n, coordinaci√≥n; aumentan impulsividad y reducen la evaluaci√≥n de riesgos.", "Porque mejoran la concentraci√≥n a corto plazo y eso genera exceso de confianza."], correct: 1 },
        { question: "¬øQu√© s√≠ntomas produce el estr√©s que afectan la conducci√≥n segura?", options: ["Aumento de agudeza visual y mayor calma.", "Cansancio, somnolencia, ansiedad, reacciones impulsivas y reducci√≥n del campo de atenci√≥n.", "Solo dolor de espalda, sin efectos cognitivos relevantes."], correct: 1 },
        { question: "¬øC√≥mo afecta la depresi√≥n a la capacidad de conducci√≥n?", options: ["Provoca somnolencia, reduce reacci√≥n, disminuye concentraci√≥n y puede llevar a reacciones impulsivas o desproporcionadas.", "Mejora la atenci√≥n por mayor preocupaci√≥n.", "No afecta si se duerme bien la noche anterior."], correct: 0 },
        { question: "¬øQu√© materiales reflejan mejor la luz aumentando la visibilidad?", options: ["Los materiales mate, que absorben la luz.", "Los materiales reflectantes, que reflejan entre 90% y 95% de la luz.", "La pintura negra mate, m√°s visible de noche."], correct: 1 },
        { question: "¬øQu√© es la visi√≥n perif√©rica?", options: ["La que permite ver detalles finos y colores con precisi√≥n.", "La que permite descubrir objetos y movimientos fuera del enfoque directo.", "La que permite ver en la oscuridad sin enfocar."], correct: 1 },
        { question: "¬øCu√°l es el papel de la retina en la visi√≥n?", options: ["Regular el tama√±o de la pupila ante la luz.", "Lubricar la superficie ocular con l√°grimas.", "Transformar los rayos de luz en se√±ales el√©ctricas para el cerebro."], correct: 2 },
        { question: "¬øQu√© c√©lulas permiten ver colores y detalles finos?", options: ["Bastones, distribuidos en toda la retina.", "Conos, ubicados en la m√°cula de la retina.", "C√©lulas ganglionares, que forman el nervio √≥ptico."], correct: 1 },
        { question: "¬øQu√© es la visi√≥n directa?", options: ["La que permite reconocer objetos en detalle al enfocarlos directamente.", "La que permite percibir objetos fuera del foco central.", "La que sirve para ver en baja luminosidad sin necesidad de enfocar."], correct: 0 },
        { question: "¬øQu√© puede ocurrir al manejar bajo estr√©s?", options: ["Se incrementa la precisi√≥n en las maniobras por la adrenalina.", "Se pueden producir reacciones impulsivas, fatiga mental y reducci√≥n del campo visual.", "Solo aparece cansancio f√≠sico, sin afectar la atenci√≥n."], correct: 1 },
        { question: "¬øCu√°l es el impacto del cansancio en la conducci√≥n?", options: ["Mejora la coordinaci√≥n porque reduce la ansiedad.", "Disminuye la concentraci√≥n, aumenta el tiempo de reacci√≥n y genera conductas imprudentes.", "Solo provoca dolor muscular, sin efectos en la toma de decisiones."], correct: 1 },
        { question: "¬øCu√°ndo es m√°s probable sentir somnolencia al conducir?", options: ["Al atardecer, entre 18:00 y 19:00 exclusivamente.", "Durante la madrugada y las primeras horas de la tarde.", "Solo despu√©s de 8 horas seguidas de manejo."], correct: 1 },
        { question: "¬øQu√© debes hacer si sientes somnolencia al volante?", options: ["Abrir la ventana y subir la m√∫sica.", "Detenerte en un lugar seguro y descansar unos 20 minutos.", "Beber agua y continuar hasta el siguiente peaje."], correct: 1 },
        { question: "¬øQu√© efectos pueden tener ciertos medicamentos sobre la conducci√≥n?", options: ["Mejoran la visi√≥n de noche al dilatar la pupila.", "Somnolencia, mareos y disminuci√≥n de la concentraci√≥n.", "√önicamente resequedad bucal, sin efectos cognitivos."], correct: 1 },
        { question: "¬øQu√© es la empat√≠a en la conducci√≥n?", options: ["Exigir prioridad propia para mantener el flujo.", "Comprender y considerar las necesidades y acciones de otros usuarios de la v√≠a.", "Ceder siempre el paso aunque no corresponda legalmente."], correct: 1 },
        { question: "¬øQu√© efecto tiene la impulsividad al conducir?", options: ["Favorece decisiones r√°pidas y m√°s seguras.", "Provoca acciones sin pensar que aumentan el riesgo de siniestros.", "Reduce la probabilidad de distracci√≥n."], correct: 1 },
        { question: "¬øC√≥mo influye la represi√≥n en la conducci√≥n?", options: ["Ayuda a mantener la concentraci√≥n en todo momento.", "Puede llevar a ignorar o minimizar riesgos evidentes.", "Solo afecta a conductores novatos."], correct: 1 },
        { question: "¬øQu√© es el punto ciego del ojo y c√≥mo afecta la conducci√≥n?", options: ["Un √°rea de visi√≥n aumentada que anticipa peligros.", "Una zona sin percepci√≥n por la entrada del nervio √≥ptico que puede impedir ver peligros.", "Un reflejo que mejora la detecci√≥n de luces."], correct: 1 },
        { question: "¬øQu√© debe hacer quien tiene una enfermedad cr√≥nica y desea conducir?", options: ["Conducir solo trayectos cortos para ‚Äúprobarse‚Äù.", "Consultar al m√©dico, reconocer s√≠ntomas y evitar conducir en fases agudas o sin tratamiento.", "Tomar caf√© y descansar m√°s antes de salir."], correct: 1 },
        { question: "¬øQu√© provocan los antihistam√≠nicos en personas con alergias al conducir?", options: ["Mejoran la ventilaci√≥n pulmonar y la atenci√≥n.", "Mayor probabilidad de somnolencia al volante.", "Solo sequedad nasal sin impacto en la conducci√≥n."], correct: 1 },
        { question: "¬øQu√© se recomienda para quienes trabajan en turnos cambiantes?", options: ["Conducir siempre de d√≠a.", "Reconocer periodos de somnolencia y no conducir si est√°n fatigados o desvelados.", "Dormir 4 horas y consumir bebidas energ√©ticas."], correct: 1 },
        { question: "¬øCu√°l es uno de los primeros signos de fatiga en la conducci√≥n?", options: ["Incremento de la euforia.", "Bostezos y sensaci√≥n de pesadez mental.", "Aumento de la visi√≥n perif√©rica."], correct: 1 },
        { question: "A 90 km/h, ¬øqu√© puede ocurrir si estornudas durante 3 segundos?", options: ["El veh√≠culo recorre entre 50 y 75 metros sin control.", "El veh√≠culo apenas avanza 10 metros sin control.", "No hay desplazamiento significativo sin control."], correct: 0 },
        { question: "¬øQu√© pausa recomienda el documento en viajes largos?", options: ["5 minutos cada hora.", "20 minutos cada 2 horas o cada 200 km.", "40 minutos solo al mediod√≠a."], correct: 1 },
        { question: "¬øC√≥mo afecta un dise√±o ergon√≥mico inadecuado del veh√≠culo?", options: ["Mejora la postura y reduce la fatiga.", "Dificulta la conducci√≥n y genera fatiga.", "Solo afecta la est√©tica interior."], correct: 1 },
        { question: "¬øQu√© efectos tiene la pasta base sobre la conducci√≥n?", options: ["Aumenta la atenci√≥n sostenida.", "Falta de coordinaci√≥n, alucinaciones, impulsividad y p√©rdida de contacto con la realidad.", "Mejora la reacci√≥n ante est√≠mulos."], correct: 1 },
        { question: "¬øQu√© droga puede causar visi√≥n borrosa, deslumbramientos e ilusiones √≥pticas?", options: ["Cannabis.", "√âxtasis.", "Alcohol a dosis moderadas."], correct: 1 },
        { question: "¬øQu√© puede provocar el deseo de validarse como conductor ante otros?", options: ["Conducci√≥n m√°s defensiva.", "Maniobras arriesgadas para impresionar a los acompa√±antes.", "Mejor cumplimiento de normas."], correct: 1 },
        { question: "¬øQu√© funci√≥n cumple el cristalino?", options: ["Regular la entrada de luz como un diafragma.", "Refractar la luz para enfocar la imagen mediante m√∫sculos y fibras.", "Producir l√°grimas para lubricar el ojo."], correct: 1 },
        { question: "¬øPor qu√© es importante mantener limpia la cabina si eres al√©rgico?", options: ["Para evitar empa√±amiento de vidrios.", "Reduce al√©rgenos (polvo, pelos) que pueden provocar crisis.", "Disminuye ruidos del motor."], correct: 1 },
        { question: "¬øQu√© actitud se recomienda ante los errores al volante?", options: ["Minimizar los errores para no perder confianza.", "Reconocerlos y aprender de ellos para mejorar la conducci√≥n.", "Culpar a factores externos (tr√°nsito, clima)."], correct: 1 },
        { question: "¬øQu√© efecto tiene el alcohol sobre los m√∫sculos oculares?", options: ["Fortalece el enfoque en visi√≥n cercana.", "Dificulta el enfoque y puede generar visi√≥n doble.", "Mejora la visi√≥n perif√©rica."], correct: 1 },
        { question: "¬øQu√© puede causar mezclar medicamentos con alcohol?", options: ["Neutralizar efectos adversos mutuos.", "Aumentar somnolencia, mareos y p√©rdida de coordinaci√≥n.", "Mejorar el estado de alerta temporalmente."], correct: 1 },
        { question: "¬øQu√© consecuencias puede tener conducir con licencia cancelada en Chile?", options: ["Solo una multa administrativa menor.", "Es un delito grave que puede conllevar penas de c√°rcel.", "Suspensi√≥n de 24 horas sin registro."], correct: 1 },
        { question: "¬øQu√© es el ‚Äúpunto de encuentro‚Äù y c√≥mo se estima mal?", options: ["Es el sitio donde se cruzan dos veh√≠culos; suele estimarse mal si uno va m√°s r√°pido.", "Es el √°rea donde se escucha mejor el claxon.", "Es el lugar donde termina un adelantamiento seguro."], correct: 0 },
        { question: "¬øQu√© provoca conducir por un camino desconocido?", options: ["Reduce la carga mental por la curiosidad.", "Exige m√°s atenci√≥n durante todo el recorrido, aumentando la fatiga mental.", "Disminuye la necesidad de mirar espejos."], correct: 1 },
        { question: "¬øC√≥mo influye el mal estado del pavimento?", options: ["No influye si la velocidad es constante.", "Genera vibraciones e incrementa el cansancio.", "Mejora el agarre y la concentraci√≥n."], correct: 1 },
        { question: "¬øQu√© efecto puede tener una mala ventilaci√≥n en el veh√≠culo?", options: ["Mantiene m√°s caliente el habit√°culo y as√≠ despierta.", "Aumenta somnolencia y fatiga del conductor.", "Solo empeora el olor ambiental."], correct: 1 },
        { question: "¬øPor qu√© evitar zonas h√∫medas si eres al√©rgico?", options: ["Se acumula m√°s smog urbano.", "Hay mayor presencia de polen y al√©rgenos que afectan la conducci√≥n.", "Porque el pavimento siempre est√° resbaloso."], correct: 1 },
        { question: "¬øQu√© acciones pueden indicar fatiga al volante?", options: ["Risa espont√°nea y euforia.", "Cambios de postura, bostezos frecuentes, movimientos nerviosos o repetitivos.", "Incremento del control fino del volante."], correct: 1 },
        { question: "¬øC√≥mo se manifiestan alteraciones cognitivas por fatiga?", options: ["Con decisiones m√°s arriesgadas y menor tiempo de reacci√≥n.", "Con mejor memoria a corto plazo.", "Con hipersensibilidad auditiva √∫til."], correct: 0 },
        { question: "¬øPor qu√© es riesgoso el estr√©s prolongado al conducir?", options: ["Porque aumenta la tolerancia a la frustraci√≥n.", "Porque puede provocar reacciones impulsivas y disminuir la atenci√≥n.", "Porque hace m√°s predecible el tr√°fico."], correct: 1 },
        { question: "¬øQu√© es el autocontrol en la conducci√≥n?", options: ["Manejar siempre a la velocidad m√°xima permitida.", "Mantener la calma y tomar decisiones racionales en situaciones dif√≠ciles.", "Evitar mirar espejos para reducir distracciones."], correct: 1 },
        { question: "¬øQu√© recomienda el documento sobre alcohol y bebidas carbonatadas?", options: ["No hay interacci√≥n relevante.", "Pueden aumentar la absorci√≥n del alcohol y su efecto.", "Disminuyen el nivel de alcohol en sangre."], correct: 1 },
        { question: "¬øPor qu√© el alcohol puede afectar m√°s a las mujeres?", options: ["Por mayor masa muscular.", "Por diferencias metab√≥licas y hormonales, elevando m√°s la tasa en sangre.", "Por tener menor sensibilidad al gusto del alcohol."], correct: 1 },
        { question: "¬øQu√© significa tener una actitud responsable al volante?", options: ["Priorizar llegar r√°pido por sobre la seguridad.", "Cumplir normas, prever riesgos y proteger a todos los usuarios.", "Conducir por el carril izquierdo para ‚Äúagilizar‚Äù el tr√°nsito."], correct: 1 },
        { question: "¬øQu√© puede generar el sentimiento de inseguridad en una persona conductora?", options: ["Conducci√≥n m√°s prudente y lenta.", "Actuar agresivamente o asumir riesgos para demostrar capacidad.", "Mayor uso del espejo retrovisor central."], correct: 1 },
        { question: "¬øQu√© es el mecanismo de represi√≥n en la conducci√≥n?", options: ["Superar miedos mediante respiraci√≥n profunda.", "Ignorar conscientemente los riesgos por enfocarse solo en ‚Äúllegar‚Äù.", "Frenar m√°s fuerte ante cada se√±al."], correct: 1 },
        { question: "Si hay un siniestro conduciendo en estado de ebriedad, ¬øqu√© puede ocurrir seg√∫n la Ley Emilia?", options: ["√önicamente una multa menor.", "Penas de c√°rcel, suspensi√≥n de licencia y multas.", "Curso de sensibilizaci√≥n sin sanciones adicionales."], correct: 1 },
        { question: "¬øQu√© se recomienda si comienzas un medicamento nuevo antes de conducir?", options: ["Conducir en rutas conocidas para ‚Äúacostumbrarse‚Äù.", "Consultar al m√©dico y evitar conducir si provoca alteraciones.", "Tomar caf√© para contrarrestar posibles efectos."], correct: 1 },
        { question: "¬øCu√°l es la recomendaci√≥n clave para personas fatigadas o desveladas por turnos?", options: ["Manejar solo en v√≠as con buena iluminaci√≥n.", "No conducir si est√°n fatigados o desvelados y reconocer sus periodos de somnolencia.", "Evitar solo autopistas y preferir calles locales."], correct: 1 },
        { question: "¬øQu√© relaci√≥n hay entre estornudar y el control del veh√≠culo?", options: ["Estornudar mejora reflejos por activaci√≥n muscular.", "Estornudar puede dejarte sin control decenas de metros a velocidad de autopista.", "No hay relaci√≥n medible entre estornudos y control."], correct: 1 },
        { question: "¬øPor qu√© se aconseja planificar descansos en viajes largos?", options: ["Para reducir el consumo de combustible.", "Para prevenir la fatiga y la somnolencia al volante.", "Para estirar las piernas por comodidad, sin impacto en la seguridad."], correct: 1 },
        { question: "¬øQu√© papel juega la ‚Äúvalidaci√≥n social‚Äù en decisiones peligrosas al conducir?", options: ["No influye si se respetan los l√≠mites de velocidad.", "Puede inducir maniobras para impresionar a otros.", "Solo afecta a adolescentes, no a adultos."], correct: 1 },
        { question: "¬øQu√© combinaci√≥n incrementa efectos negativos en conducci√≥n?", options: ["Analg√©sicos suaves con agua.", "Medicamentos con alcohol.", "Antihistam√≠nicos con alimentos grasos."], correct: 1 },
        { question: "¬øQu√© recomendaci√≥n espec√≠fica se da para carreteras rectas y mon√≥tonas de noche?", options: ["Aumentar la velocidad para terminar antes.", "Estar atento a s√≠ntomas de fatiga y hacer pausas frecuentes.", "Circular pegado a la berma para ‚Äúdescansar la vista‚Äù."], correct: 1 },
        { question: "¬øQu√© h√°bito de higiene del veh√≠culo beneficia a personas al√©rgicas?", options: ["Usar aromatizantes fuertes.", "Mantener limpia la cabina para reducir al√©rgenos.", "Mantener alfombras h√∫medas para atrapar polvo."], correct: 1 },
        { question: "¬øCu√°l es una se√±al conductual temprana de fatiga?", options: ["Fijar la mirada sin parpadear durante minutos.", "Bostezos y movimientos nerviosos o repetitivos.", "Mayor precisi√≥n en cambios de marcha."], correct: 1 },
        { question: "¬øQu√© consejo pr√°ctico resume la respuesta ante se√±ales de fatiga al conducir?", options: ["Continuar a menor velocidad pero sin detenerse.", "Detenerse en un lugar seguro y descansar antes de continuar.", "Activar luces altas para ‚Äúestimular la vista‚Äù."], correct: 1 }
    ];
    // --- VARIABLES GLOBALES ---
    let currentQuestionIndex;
    let userAnswers;
    let timerInterval;
    let shuffledQuestions = [];
    let passMark; // NUEVO

    // --- ELEMENTOS DEL DOM ---
    const startScreen = document.getElementById('start-screen');
    const examScreen = document.getElementById('exam-screen');
    const resultsScreen = document.getElementById('results-screen');
    const startBtn = document.getElementById('start-btn');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const restartBtn = document.getElementById('restart-btn');
    const resetExamBtn = document.getElementById('reset-exam-btn');
    const timeSelect = document.getElementById('time-select');
    const passMarkSelect = document.getElementById('pass-mark-select'); // NUEVO
    const startText = document.getElementById('start-text');
    const timerDisplay = document.getElementById('timer-display');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const resultsTitle = document.getElementById('results-title');
    const correctCountEl = document.getElementById('correct-count');
    const incorrectCountEl = document.getElementById('incorrect-count');
    const totalCountEl = document.getElementById('total-count');
    const finalScoreEl = document.getElementById('final-score');
    const examStatusEl = document.getElementById('exam-status');
    const reviewSection = document.getElementById('review-section');
    const incorrectAnswersList = document.getElementById('incorrect-answers-list');
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body; 

    // --- FUNCIONES ---

    function toggleTheme() {
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            localStorage.setItem('theme', 'light-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark-mode') {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            body.classList.remove('dark-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function randomizeQuestionOptions() {
        shuffledQuestions = JSON.parse(JSON.stringify(questions));
        shuffledQuestions.forEach(q => {
            const correctAnswerText = q.options[q.correct];
            shuffleArray(q.options);
            const newCorrectIndex = q.options.findIndex(option => option === correctAnswerText);
            q.correct = newCorrectIndex;
        });
    }

    function initializeApp() {
        if (questions.length > 0) {
            startText.textContent = `Prep√°rate con ${questions.length} preguntas.`;
            startBtn.disabled = false;
        } else {
            startText.textContent = 'No hay preguntas cargadas. Agrega preguntas en el array "questions" para comenzar.';
            startBtn.disabled = true;
        }
        startBtn.addEventListener('click', startExam);
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', prevQuestion);
        restartBtn.addEventListener('click', restartExam);
        resetExamBtn.addEventListener('click', restartExam);
        themeToggle.addEventListener('click', toggleTheme);
        loadTheme();
    }

    function startExam() {
      randomizeQuestionOptions();
      currentQuestionIndex = 0;
      userAnswers = new Array(shuffledQuestions.length).fill(null);
      startScreen.classList.add('hidden');
      resultsScreen.classList.add('hidden');
      examScreen.classList.remove('hidden');
      reviewSection.classList.add('hidden');
      
      // NUEVO: Capturar el valor de la nota de aprobaci√≥n
      passMark = parseInt(passMarkSelect.value, 10);
      
      const durationMinutes = parseInt(timeSelect.value, 10);
      startTimer(durationMinutes);
      showQuestion();
    }
    
    function showQuestion() {
        const q = shuffledQuestions[currentQuestionIndex];
        if (!q) return; 

        updateProgress();
        questionNumberEl.textContent = `Pregunta ${currentQuestionIndex + 1}`;
        questionTextEl.textContent = q.question;
        optionsContainer.innerHTML = '';
        const answered = userAnswers[currentQuestionIndex] !== null;
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option';
            btn.innerHTML = `<span class="option-letter">${String.fromCharCode(65 + idx)}</span>${opt}`;
            btn.onclick = () => selectOption(idx);
            
            if (answered) {
               btn.classList.add('disabled');
                if (idx === q.correct) {
                    btn.classList.add('correct');
                } else if (idx === userAnswers[currentQuestionIndex]) {
                    btn.classList.add('incorrect');
                 }
            }
            optionsContainer.appendChild(btn);
        });
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.textContent = (currentQuestionIndex === shuffledQuestions.length - 1) ? 'Finalizar Examen' : 'Siguiente ‚Üí';
    }

    function selectOption(selectedIndex) {
      if (userAnswers[currentQuestionIndex] !== null) return; 
      userAnswers[currentQuestionIndex] = selectedIndex;
      showQuestion();
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < shuffledQuestions.length - 1) {
        currentQuestionIndex++;
        showQuestion();
      } else {
        showResults("¬°Examen Completado!");
      }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            showQuestion();
        }
    }

    function showResults(title) {
        clearInterval(timerInterval);
        examScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        resultsTitle.textContent = title;
        const correctCount = userAnswers.filter((answer, index) => answer === shuffledQuestions[index].correct).length;
        const totalAnswered = userAnswers.filter(answer => answer !== null).length;
        const incorrectCount = totalAnswered - correctCount;
        const score = shuffledQuestions.length > 0 ? Math.round((correctCount / shuffledQuestions.length) * 100) : 0;
        
        correctCountEl.textContent = correctCount;
        incorrectCountEl.textContent = incorrectCount;
        totalCountEl.textContent = shuffledQuestions.length;
        finalScoreEl.textContent = `${score}%`;

        // NUEVO: Usar la variable 'passMark' en lugar de un valor fijo
        if (score >= passMark) {
            examStatusEl.textContent = 'Aprobado';
            examStatusEl.className = 'score-value status passed';
        } else {
            examStatusEl.textContent = 'Reprobado';
            examStatusEl.className = 'score-value status failed';
        }
        
        displayIncorrectAnswers();
    }

    function displayIncorrectAnswers() {
        incorrectAnswersList.innerHTML = '';
        const incorrectAnswers = [];

        userAnswers.forEach((answer, index) => {
            if (answer !== null && answer !== shuffledQuestions[index].correct) {
                const q = shuffledQuestions[index];
                incorrectAnswers.push({
                    questionNumber: index + 1,
                    question: q.question,
                    userAnswer: q.options[answer],
                    correctAnswer: q.options[q.correct]
                });
            }
        });
        if (incorrectAnswers.length > 0) {
            reviewSection.classList.remove('hidden');
            incorrectAnswers.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'incorrect-answer-item';
                itemEl.innerHTML = `
                    <p><strong>Pregunta ${item.questionNumber}:</strong> ${item.question}</p>
                    <p class="user-answer"><strong>Tu respuesta:</strong> ${item.userAnswer}</p>
                    <p class="correct-answer"><strong>Respuesta correcta:</strong> ${item.correctAnswer}</p>
                `;
                incorrectAnswersList.appendChild(itemEl);
            });
        } else {
            reviewSection.classList.add('hidden');
        }
    }

    function restartExam() {
        clearInterval(timerInterval);
        startScreen.classList.remove('hidden');
        examScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        reviewSection.classList.add('hidden');
        initializeApp(); // Re-inicializamos para verificar si hay preguntas
    }

    function startTimer(minutes) {
        let timeInSeconds = minutes * 60;
        timerInterval = setInterval(() => {
            if (timeInSeconds <= 0) {
                clearInterval(timerInterval);
                timerDisplay.textContent = "00:00";
                showResults("¬°Se acab√≥ el tiempo!");
                return;
               }

            timeInSeconds--;
            const remMinutes = Math.floor(timeInSeconds / 60);
            const remSeconds = timeInSeconds % 60;
            timerDisplay.textContent = `${String(remMinutes).padStart(2, '0')}:${String(remSeconds).padStart(2, '0')}`;
        }, 1000);
    }
    
    function updateProgress() {
      const percentage = shuffledQuestions.length > 0 ?
      ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100 : 0;
      progressFill.style.width = percentage + '%';
      progressText.textContent = `Pregunta ${currentQuestionIndex + 1} de ${shuffledQuestions.length}`;
    }

    // --- INICIAR APP ---
    initializeApp();
});
</script>
</body>
</html>
