<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Examen</title>
  <style>
    :root {
      /* --- Variables de Color Modo Claro (Default) --- */
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --container-bg: rgba(255, 255, 255, .95);
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --border-color: #e2e8f0;
      --card-bg: #fff;
      --button-bg: #f7fafc;
      --button-hover-bg: #edf2f7;
      --button-secondary-bg: #e2e8f0;
      --button-secondary-hover-bg: #cbd5e0;
      --correct-bg: #e6fffa;
      --correct-border: #38a169;
      --correct-text: #2f855a;
      --incorrect-bg: #fff5f5;
      --incorrect-border: #e53e3e;
      --incorrect-text: #c53030;
    }

    .dark-mode {
      /* --- Variables de Color Modo Oscuro --- */
      --bg-gradient-start: #1a202c;
      --bg-gradient-end: #2d3748;
      --container-bg: rgba(45, 55, 72, .95);
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5e0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --card-bg: #2d3748;
      --button-bg: #4a5568;
      --button-hover-bg: #2d3748;
      --button-secondary-bg: #4a5568;
      --button-secondary-hover-bg: #718096;
      --correct-bg: #2f855a;
      --correct-border: #38a169;
      --correct-text: #e6fffa;
      --incorrect-bg: #c53030;
      --incorrect-border: #e53e3e;
      --incorrect-text: #fff5f5;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--text-primary);
      transition: background .3s ease;
    }
    .container {
      background: var(--container-bg);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      padding: 40px;
      transition: all .3s ease;
      position: relative;
    }
    /* --- BOT√ìN DE MODO D√çA/NOCHE --- */
    #theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    #theme-toggle:hover {
        background: var(--button-secondary-hover-bg);
        transform: scale(1.1) rotate(15deg);
    }

    .main-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }
    .main-header-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-secondary);
    }
    .header { text-align: center; margin-bottom: 30px; }
    .title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; color: var(--text-primary); }
    .subtitle { color: var(--text-muted); font-size: 1.1rem; }
    
    .timer-setup { margin: 20px 0; text-align: center; } /* Reducido el margen vertical */
    .timer-setup label { font-weight: 600; margin-right: 10px; font-size: 1.1rem; color: var(--text-secondary); }
    .timer-setup select {
        padding: 8px 12px;
        border-radius: 8px;
        border: 2px solid var(--border-color);
        background-color: var(--button-bg);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
    }
    .exam-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
    }
    #timer-display {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--bg-gradient-end);
        background: var(--button-bg);
        padding: 5px 15px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }
    #reset-exam-btn {
        position: absolute;
        top: -20px;
        right: -20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    #reset-exam-btn:hover { background: var(--button-secondary-hover-bg); transform: rotate(90deg); }

    .progress-container { margin-bottom: 30px; }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--bg-gradient-start), var(--bg-gradient-end));
      border-radius: 10px;
      transition: width .3s ease;
    }
    .progress-text { text-align: center; color: var(--text-secondary); font-weight: 600; }
    .question-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.06);
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
    }
    .question-number { color: var(--bg-gradient-start); font-size: .9rem; font-weight: 600; margin-bottom:15px; }
    .question-text { font-size:1.3rem; line-height:1.6; font-weight:600; margin-bottom:25px; color: var(--text-primary); }
    .options { display:grid; gap:12px; }
    .option {
      background:var(--button-bg);
      border:2px solid var(--border-color);
      border-radius:12px;
      padding:18px 20px;
      cursor:pointer;
      transition:all .2s ease;
      display:flex;
      align-items:center;
      font-size:1rem;
      color:var(--text-secondary);
      text-align: left;
    }
    .option:hover:not(.disabled) {
      border-color:var(--bg-gradient-start);
      background:var(--button-hover-bg);
      transform:translateY(-2px);
      box-shadow:0 4px 20px rgba(102,126,234,0.15);
    }
    .option.disabled { pointer-events:none; }
    .option.correct { border-color:var(--correct-border)!important; background:var(--correct-bg)!important; color:var(--correct-text)!important; }
    .option.incorrect { border-color:var(--incorrect-border)!important; background:var(--incorrect-bg)!important; color:var(--incorrect-text)!important; }
    .option-letter {
      background:var(--bg-gradient-start);
      color:white;
      width:30px;
      height:30px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      margin-right:15px;
      font-size:.9rem;
      flex-shrink: 0;
    }
    .navigation { display:flex; justify-content:space-between; align-items:center; margin-top:30px; }
    .btn {
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color:white;
      border:none;
      padding:12px 24px;
      border-radius:12px;
      cursor:pointer;
      font-size:1rem;
      font-weight:600;
      transition:all .3s ease;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn-secondary { background: var(--button-secondary-bg); color: var(--text-secondary); }
    .btn-secondary:hover:not(:disabled) { background: var(--button-secondary-hover-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .btn:hover:not(:disabled) {
      transform:translateY(-2px);
      box-shadow:0 8px 25px rgba(102,126,234,0.3);
    }
    .btn:disabled { opacity:.5; cursor:not-allowed; transform:none; box-shadow: none;}
    .hidden { display:none; }
    
    .results { text-align:center; padding:40px 20px; }
    .results h2 { font-size:2.2rem; margin-bottom:20px; color: var(--text-primary); }
    .score {
      font-size:4rem;
      font-weight:800;
      margin:30px 0;
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .score-details {
      background: var(--button-bg);
      border-radius:16px;
      padding:25px;
      margin:30px 0;
      border:1px solid var(--border-color);
    }
    .score-item { display:flex; justify-content:space-between; margin:10px 0; font-size:1.1rem; }
    .score-label { color: var(--text-secondary); }
    .score-value { font-weight:600; color: var(--text-primary); }
    .status.passed { color:#38a169; }
    .status.failed { color:#e53e3e; }

    #review-section h3 {
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
    }
    .incorrect-answer-item {
        background: var(--incorrect-bg);
        border: 1px solid var(--incorrect-border);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        text-align: left;
    }
    .incorrect-answer-item p { margin-bottom: 8px; line-height: 1.5; color: var(--text-primary); }
    .incorrect-answer-item .user-answer { color: var(--incorrect-text); }
    .incorrect-answer-item .correct-answer { color: var(--correct-text); font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <button id="theme-toggle" title="Cambiar Tema">üåì</button>
    <div class="main-header">
        <h2 class="main-header-title">Examen de Conducir - Cap√≠tulos 3 y 4</h2>
    </div>

    <div id="start-screen">
      <div class="header">
        <h1 class="title">üöó Simulador de Examen</h1>
        <p class="subtitle">Examen de Conducir - Chile</p>
      </div>
      <div class="timer-setup">
          <label for="time-select">Selecciona el tiempo:</label>
          <select id="time-select">
              <option value="15" selected>15 Minutos</option>
              <option value="20">20 Minutos</option>
              <option value="25">25 Minutos</option>
              <option value="30">30 Minutos</option>
              <option value="35">35 Minutos</option>
              <option value="40">40 Minutos</option>
              <option value="45">45 Minutos</option>
              <option value="50">50 Minutos</option>
              <option value="55">55 Minutos</option>
              <option value="60">60 Minutos</option>
          </select>
      </div>

      <div class="timer-setup">
          <label for="pass-mark-select">Nota de Aprobaci√≥n:</label>
          <select id="pass-mark-select">
              <option value="50">50%</option>
              <option value="60">60%</option>
              <option value="70">70%</option>
              <option value="80">80%</option>
              <option value="85" selected>85%</option>
              <option value="90">90%</option>
              <option value="100">100%</option>
          </select>
      </div>
      <div style="text-align:center;">
         <p id="start-text" style="margin:20px 0;color: var(--text-muted);font-size:1.1rem;"></p>
        <button id="start-btn" class="btn">üöÄ Comenzar Examen</button>
      </div>
    </div>

    <div id="exam-screen" class="hidden">
      <button id="reset-exam-btn" title="Reiniciar Examen">üîÑ</button>
       <div class="exam-header">
         <h2 style="color: var(--text-muted);">Examen en Curso</h2>
         <div id="timer-display">--:--</div>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
           <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text"></div>
      </div>
      <div class="question-card">
        <div class="question-number" id="question-number"></div>
        <div class="question-text" id="question-text"></div>
        <div class="options" id="options"></div>
      </div>
      <div class="navigation">
        <button class="btn btn-secondary" id="prev-btn">‚Üê Anterior</button>
         <button class="btn" id="next-btn">Siguiente ‚Üí</button>
      </div>
    </div>

    <div id="results-screen" class="hidden">
      <div class="results">
        <h2 id="results-title">¬°Examen Completado!</h2>
        <div class="score" id="final-score"></div>
        <div class="score-details">
          <div class="score-item">
            <span class="score-label">Respuestas correctas:</span>
            <span class="score-value" id="correct-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Respuestas incorrectas:</span>
            <span class="score-value" id="incorrect-count"></span>
          </div>
          <div class="score-item">
            <span class="score-label">Total de preguntas:</span>
            <span class="score-value" id="total-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Estado:</span>
            <span class="score-value status" id="exam-status"></span>
          </div>
        </div>
        <button id="restart-btn" class="btn">üîÑ Reiniciar Examen</button>

        <div id="review-section" class="hidden" style="margin-top: 40px;">
            <h3>Revisi√≥n de Respuestas Incorrectas</h3>
            <div id="incorrect-answers-list" style="margin-top: 20px;"></div>
        </div>
      </div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', () => {
    // --- BANCO DE PREGUNTAS ---
    let questions = [
        {
            question: "¬øQu√© significa una se√±al triangular con borde rojo y un ciervo en el centro?",
            options: ["Cruce de peatones", "Paso de animales", "Zona de descanso"],
            correct: 1
        },
        {
            question: "¬øCu√°l es la velocidad m√°xima permitida en zonas urbanas en Chile, salvo que se indique lo contrario?",
            options: ["50 km/h", "60 km/h", "70 km/h"],
            correct: 0
        },
        {
            question: "¬øQu√© debe hacer un conductor al acercarse a una intersecci√≥n sin sem√°foro ni se√±al de ceda el paso?",
            options: ["Acelerar para pasar r√°pido", "Detenerse completamente", "Ceder el paso a los veh√≠culos de la derecha"],
            correct: 2
        },
        {
            question: "¬øQu√© indica una l√≠nea blanca continua en la carretera?",
            options: ["Se permite adelantar", "Prohibido adelantar", "Zona de estacionamiento"],
            correct: 1
        },
        {
            question: "¬øCu√°l es el prop√≥sito principal del cintur√≥n de seguridad?",
            options: ["Mejorar la comodidad", "Reducir lesiones en caso de accidente", "Cumplir con la normativa"],
            correct: 1
        }
    ];
    // --- VARIABLES GLOBALES ---
    let currentQuestionIndex;
    let userAnswers;
    let timerInterval;
    let shuffledQuestions = [];
    let passMark;

    // --- ELEMENTOS DEL DOM ---
    const startScreen = document.getElementById('start-screen');
    const examScreen = document.getElementById('exam-screen');
    const resultsScreen = document.getElementById('results-screen');
    const startBtn = document.getElementById('start-btn');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const restartBtn = document.getElementById('restart-btn');
    const resetExamBtn = document.getElementById('reset-exam-btn');
    const timeSelect = document.getElementById('time-select');
    const passMarkSelect = document.getElementById('pass-mark-select');
    const startText = document.getElementById('start-text');
    const timerDisplay = document.getElementById('timer-display');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const resultsTitle = document.getElementById('results-title');
    const correctCountEl = document.getElementById('correct-count');
    const incorrectCountEl = document.getElementById('incorrect-count');
    const totalCountEl = document.getElementById('total-count');
    const finalScoreEl = document.getElementById('final-score');
    const examStatusEl = document.getElementById('exam-status');
    const reviewSection = document.getElementById('review-section');
    const incorrectAnswersList = document.getElementById('incorrect-answers-list');
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body; 

    // --- FUNCIONES ---

    function toggleTheme() {
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            localStorage.setItem('theme', 'light-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark-mode') {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            body.classList.remove('dark-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function randomizeQuestionOptions() {
        shuffledQuestions = JSON.parse(JSON.stringify(questions));
        shuffledQuestions.forEach(q => {
            const correctAnswerText = q.options[q.correct];
            shuffleArray(q.options);
            const newCorrectIndex = q.options.findIndex(option => option === correctAnswerText);
            q.correct = newCorrectIndex;
        });
    }

    function initializeApp() {
        if (questions.length > 0) {
            startText.textContent = `Prep√°rate con ${questions.length} preguntas.`;
            startBtn.disabled = false;
        } else {
            startText.textContent = 'No hay preguntas cargadas. Agrega preguntas en el array "questions" para comenzar.';
            startBtn.disabled = true;
        }
        startBtn.addEventListener('click', startExam);
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', prevQuestion);
        restartBtn.addEventListener('click', restartExam);
        resetExamBtn.addEventListener('click', restartExam);
        themeToggle.addEventListener('click', toggleTheme);
        loadTheme();
    }

    function startExam() {
      randomizeQuestionOptions();
      currentQuestionIndex = 0;
      userAnswers = new Array(shuffledQuestions.length).fill(null);
      startScreen.classList.add('hidden');
      resultsScreen.classList.add('hidden');
      examScreen.classList.remove('hidden');
      reviewSection.classList.add('hidden');
      
      passMark = parseInt(passMarkSelect.value, 10);
      
      const durationMinutes = parseInt(timeSelect.value, 10);
      startTimer(durationMinutes);
      showQuestion();
    }
    
    function showQuestion() {
        const q = shuffledQuestions[currentQuestionIndex];
        if (!q) return; 

        updateProgress();
        questionNumberEl.textContent = `Pregunta ${currentQuestionIndex + 1}`;
        questionTextEl.textContent = q.question;
        optionsContainer.innerHTML = '';
        const answered = userAnswers[currentQuestionIndex] !== null;
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option';
            btn.innerHTML = `<span class="option-letter">${String.fromCharCode(65 + idx)}</span>${opt}`;
            btn.onclick = () => selectOption(idx);
            
            if (answered) {
               btn.classList.add('disabled');
                if (idx === q.correct) {
                    btn.classList.add('correct');
                } else if (idx === userAnswers[currentQuestionIndex]) {
                    btn.classList.add('incorrect');
                 }
            }
            optionsContainer.appendChild(btn);
        });
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.textContent = (currentQuestionIndex === shuffledQuestions.length - 1) ? 'Finalizar Examen' : 'Siguiente ‚Üí';
    }

    function selectOption(selectedIndex) {
      if (userAnswers[currentQuestionIndex] !== null) return; 
      userAnswers[currentQuestionIndex] = selectedIndex;
      showQuestion();
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < shuffledQuestions.length - 1) {
        currentQuestionIndex++;
        showQuestion();
      } else {
        showResults("¬°Examen Completado!");
      }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            showQuestion();
        }
    }

    function showResults(title) {
        clearInterval(timerInterval);
        examScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        resultsTitle.textContent = title;
        const correctCount = userAnswers.filter((answer, index) => answer === shuffledQuestions[index].correct).length;
        const totalAnswered = userAnswers.filter(answer => answer !== null).length;
        const incorrectCount = totalAnswered - correctCount;
        const score = shuffledQuestions.length > 0 ? Math.round((correctCount / shuffledQuestions.length) * 100) : 0;
        
        correctCountEl.textContent = correctCount;
        incorrectCountEl.textContent = incorrectCount;
        totalCountEl.textContent = shuffledQuestions.length;
        finalScoreEl.textContent = `${score}%`;

        if (score >= passMark) {
            examStatusEl.textContent = 'Aprobado';
            examStatusEl.className = 'score-value status passed';
        } else {
            examStatusEl.textContent = 'Reprobado';
            examStatusEl.className = 'score-value status failed';
        }
        
        displayIncorrectAnswers();
    }

    function displayIncorrectAnswers() {
        incorrectAnswersList.innerHTML = '';
        const incorrectAnswers = [];

        userAnswers.forEach((answer, index) => {
            if (answer !== null && answer !== shuffledQuestions[index].correct) {
                const q = shuffledQuestions[index];
                incorrectAnswers.push({
                    questionNumber: index + 1,
                    question: q.question,
                    userAnswer: q.options[answer],
                    correctAnswer: q.options[q.correct]
                });
            }
        });
        if (incorrectAnswers.length > 0) {
            reviewSection.classList.remove('hidden');
            incorrectAnswers.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'incorrect-answer-item';
                itemEl.innerHTML = `
                    <p><strong>Pregunta ${item.questionNumber}:</strong> ${item.question}</p>
                    <p class="user-answer"><strong>Tu respuesta:</strong> ${item.userAnswer}</p>
                    <p class="correct-answer"><strong>Respuesta correcta:</strong> ${item.correctAnswer}</p>
                `;
                incorrectAnswersList.appendChild(itemEl);
            });
        } else {
            reviewSection.classList.add('hidden');
        }
    }

    function restartExam() {
        clearInterval(timerInterval);
        startScreen.classList.remove('hidden');
        examScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        reviewSection.classList.add('hidden');
        initializeApp();
    }

    function startTimer(minutes) {
        let timeInSeconds = minutes * 60;
        timerInterval = setInterval(() => {
            if (timeInSeconds <= 0) {
                clearInterval(timerInterval);
                timerDisplay.textContent = "00:00";
                showResults("¬°Se acab√≥ el tiempo!");
                return;
            }

            timeInSeconds--;
            const remMinutes = Math.floor(timeInSeconds / 60);
            const remSeconds = timeInSeconds % 60;
            timerDisplay.textContent = `${String(remMinutes).padStart(2, '0')}:${String(remSeconds).padStart(2, '0')}`;
        }, 1000);
    }
    
    function updateProgress() {
      const percentage = shuffledQuestions.length > 0 ?
      ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100 : 0;
      progressFill.style.width = percentage + '%';
      progressText.textContent = `Pregunta ${currentQuestionIndex + 1} de ${shuffledQuestions.length}`;
    }

    // --- INICIAR APP ---
    initializeApp();
});
</script>
</body>
</html>