<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Examen de Conducir</title>
  <style>
    :root {
      /* --- Variables de Color Modo Claro (Default) --- */
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --container-bg: rgba(255, 255, 255, .95);
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --border-color: #e2e8f0;
      --card-bg: #fff;
      --button-bg: #f7fafc;
      --button-hover-bg: #edf2f7;
      --button-secondary-bg: #e2e8f0;
      --button-secondary-hover-bg: #cbd5e0;
      --correct-bg: #e6fffa;
      --correct-border: #38a169;
      --correct-text: #2f855a;
      --incorrect-bg: #fff5f5;
      --incorrect-border: #e53e3e;
      --incorrect-text: #c53030;
    }

    .dark-mode {
      /* --- Variables de Color Modo Oscuro --- */
      --bg-gradient-start: #1a202c;
      --bg-gradient-end: #2d3748;
      --container-bg: rgba(45, 55, 72, .95);
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5e0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --card-bg: #2d3748;
      --button-bg: #4a5568;
      --button-hover-bg: #2d3748;
      --button-secondary-bg: #4a5568;
      --button-secondary-hover-bg: #718096;
      --correct-bg: #2f855a;
      --correct-border: #38a169;
      --correct-text: #e6fffa;
      --incorrect-bg: #c53030;
      --incorrect-border: #e53e3e;
      --incorrect-text: #fff5f5;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--text-primary);
      transition: background .3s ease;
    }
    .container {
      background: var(--container-bg);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      padding: 40px;
      transition: all .3s ease;
      position: relative;
    }
    /* --- BOT√ìN DE MODO D√çA/NOCHE --- */
    #theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    #theme-toggle:hover {
        background: var(--button-secondary-hover-bg);
        transform: scale(1.1) rotate(15deg);
    }

    .main-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }
    .main-header-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-secondary);
    }
    .header { text-align: center; margin-bottom: 30px; }
    .title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; color: var(--text-primary); }
    .subtitle { color: var(--text-muted); font-size: 1.1rem; }
    
    .timer-setup { margin: 20px 0; text-align: center; } /* Reducido el margen vertical */
    .timer-setup label { font-weight: 600; margin-right: 10px; font-size: 1.1rem; color: var(--text-secondary); }
    .timer-setup select {
        padding: 8px 12px;
        border-radius: 8px;
        border: 2px solid var(--border-color);
        background-color: var(--button-bg);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
    }
    .exam-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
    }
    #timer-display {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--bg-gradient-end);
        background: var(--button-bg);
        padding: 5px 15px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }
    #reset-exam-btn {
        position: absolute;
        top: -20px;
        right: -20px;
        background: var(--button-secondary-bg);
        color: var(--text-secondary);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    #reset-exam-btn:hover { background: var(--button-secondary-hover-bg); transform: rotate(90deg); }

    .progress-container { margin-bottom: 30px; }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--bg-gradient-start), var(--bg-gradient-end));
      border-radius: 10px;
      transition: width .3s ease;
    }
    .progress-text { text-align: center; color: var(--text-secondary); font-weight: 600; }
    .question-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.06);
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
    }
    .question-number { color: var(--bg-gradient-start); font-size: .9rem; font-weight: 600; margin-bottom:15px; }
    .question-text { font-size:1.3rem; line-height:1.6; font-weight:600; margin-bottom:25px; color: var(--text-primary); }
    .options { display:grid; gap:12px; }
    .option {
      background:var(--button-bg);
      border:2px solid var(--border-color);
      border-radius:12px;
      padding:18px 20px;
      cursor:pointer;
      transition:all .2s ease;
      display:flex;
      align-items:center;
      font-size:1rem;
      color:var(--text-secondary);
      text-align: left;
    }
    .option:hover:not(.disabled) {
      border-color:var(--bg-gradient-start);
      background:var(--button-hover-bg);
      transform:translateY(-2px);
      box-shadow:0 4px 20px rgba(102,126,234,0.15);
    }
    .option.disabled { pointer-events:none; }
    .option.correct { border-color:var(--correct-border)!important; background:var(--correct-bg)!important; color:var(--correct-text)!important; }
    .option.incorrect { border-color:var(--incorrect-border)!important; background:var(--incorrect-bg)!important; color:var(--incorrect-text)!important; }
    .option-letter {
      background:var(--bg-gradient-start);
      color:white;
      width:30px;
      height:30px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      margin-right:15px;
      font-size:.9rem;
      flex-shrink: 0;
    }
    .navigation { display:flex; justify-content:space-between; align-items:center; margin-top:30px; }
    .btn {
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color:white;
      border:none;
      padding:12px 24px;
      border-radius:12px;
      cursor:pointer;
      font-size:1rem;
      font-weight:600;
      transition:all .3s ease;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn-secondary { background: var(--button-secondary-bg); color: var(--text-secondary); }
    .btn-secondary:hover:not(:disabled) { background: var(--button-secondary-hover-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .btn:hover:not(:disabled) {
      transform:translateY(-2px);
      box-shadow:0 8px 25px rgba(102,126,234,0.3);
    }
    .btn:disabled { opacity:.5; cursor:not-allowed; transform:none; box-shadow: none;}
    .hidden { display:none; }
    
    .results { text-align:center; padding:40px 20px; }
    .results h2 { font-size:2.2rem; margin-bottom:20px; color: var(--text-primary); }
    .score {
      font-size:4rem;
      font-weight:800;
      margin:30px 0;
      background:linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .score-details {
      background: var(--button-bg);
      border-radius:16px;
      padding:25px;
      margin:30px 0;
      border:1px solid var(--border-color);
    }
    .score-item { display:flex; justify-content:space-between; margin:10px 0; font-size:1.1rem; }
    .score-label { color: var(--text-secondary); }
    .score-value { font-weight:600; color: var(--text-primary); }
    .status.passed { color:#38a169; }
    .status.failed { color:#e53e3e; }

    #review-section h3 {
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
    }
    .incorrect-answer-item {
        background: var(--incorrect-bg);
        border: 1px solid var(--incorrect-border);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        text-align: left;
    }
    .incorrect-answer-item p { margin-bottom: 8px; line-height: 1.5; color: var(--text-primary); }
    .incorrect-answer-item .user-answer { color: var(--incorrect-text); }
    .incorrect-answer-item .correct-answer { color: var(--correct-text); font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <button id="theme-toggle" title="Cambiar Tema">üåì</button>
    <div class="main-header">
        <h2 class="main-header-title">Reglamento de Tr√°nsito de Chile</h2>
    </div>

    <div id="start-screen">
      <div class="header">
        <h1 class="title">üìù Simulador de Examen de Conducir</h1>
        <p class="subtitle">Pon a prueba tus conocimientos</p>
      </div>
      <div class="timer-setup">
          <label for="time-select">Selecciona el tiempo:</label>
          <select id="time-select">
              <option value="15" selected>15 Minutos</option>
              <option value="20">20 Minutos</option>
              <option value="25">25 Minutos</option>
              <option value="30">30 Minutos</option>
              <option value="35">35 Minutos</option>
              <option value="40">40 Minutos</option>
              <option value="45">45 Minutos</option>
              <option value="50">50 Minutos</option>
              <option value="55">55 Minutos</option>
              <option value="60">60 Minutos</option>
          </select>
      </div>

      <div class="timer-setup">
          <label for="pass-mark-select">Nota de Aprobaci√≥n:</label>
          <select id="pass-mark-select">
              <option value="50">50%</option>
              <option value="60">60%</option>
              <option value="70">70%</option>
              <option value="80">80%</option>
              <option value="85" selected>85%</option>
              <option value="90">90%</option>
              <option value="100">100%</option>
          </select>
      </div>
      <div style="text-align:center;">
         <p id="start-text" style="margin:20px 0;color: var(--text-muted);font-size:1.1rem;"></p>
        <button id="start-btn" class="btn">üöÄ Comenzar Examen</button>
      </div>
    </div>

    <div id="exam-screen" class="hidden">
      <button id="reset-exam-btn" title="Reiniciar Examen">üîÑ</button>
       <div class="exam-header">
         <h2 style="color: var(--text-muted);">Examen en Curso</h2>
         <div id="timer-display">--:--</div>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
           <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text"></div>
      </div>
      <div class="question-card">
        <div class="question-number" id="question-number"></div>
        <div class="question-text" id="question-text"></div>
        <div class="options" id="options"></div>
      </div>
      <div class="navigation">
        <button class="btn btn-secondary" id="prev-btn">‚Üê Anterior</button>
         <button class="btn" id="next-btn">Siguiente ‚Üí</button>
      </div>
    </div>

    <div id="results-screen" class="hidden">
      <div class="results">
        <h2 id="results-title">¬°Examen Completado!</h2>
        <div class="score" id="final-score"></div>
        <div class="score-details">
          <div class="score-item">
            <span class="score-label">Respuestas correctas:</span>
            <span class="score-value" id="correct-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Respuestas incorrectas:</span>
            <span class="score-value" id="incorrect-count"></span>
          </div>
          <div class="score-item">
            <span class="score-label">Total de preguntas:</span>
            <span class="score-value" id="total-count"></span>
           </div>
          <div class="score-item">
            <span class="score-label">Estado:</span>
            <span class="score-value status" id="exam-status"></span>
          </div>
        </div>
        <button id="restart-btn" class="btn">üîÑ Reiniciar Examen</button>

        <div id="review-section" class="hidden" style="margin-top: 40px;">
            <h3>Revisi√≥n de Respuestas Incorrectas</h3>
            <div id="incorrect-answers-list" style="margin-top: 20px;"></div>
        </div>
      </div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', () => {
    // --- BANCO DE PREGUNTAS ---
    let questions = [
        { question: 'Seg√∫n las indicaciones de Carabineros de Chile, ¬øqu√© acci√≥n deben realizar los conductores si ven a un carabinero de frente o de espalda?', options: ['Avanzar, ya que la v√≠a est√° libre.', 'Detenerse.', 'Prepararse para avanzar, porque es una se√±al de advertencia.'], correct: 1 },
        { question: '¬øCu√°l es el significado de la se√±al de un carabinero con el brazo en alto?', options: ['Autoriza a los veh√≠culos para que avancen r√°pidamente.', 'Indica detenci√≥n inmediata para todos los flujos.', 'Indica advertencia, y quienes tienen v√≠a libre deben prepararse para detenerse.'], correct: 2 },
        { question: 'En caso de que las indicaciones de un sem√°foro y las de un Carabinero de Chile sean contradictorias, ¬øcu√°l de ellas prevalece?', options: ['La del sem√°foro, porque es una se√±al autom√°tica.', 'La de Carabineros de Chile.', 'El conductor debe decidir seg√∫n la congesti√≥n del momento.'], correct: 1 },
        { question: '¬øQu√© indica la luz amarilla de un sem√°foro?', options: ['Advierte peligro y se debe continuar con velocidad reducida.', 'Indica prevenci√≥n y los veh√≠culos deben detenerse antes de entrar al cruce.', 'Permite virar con precauci√≥n, aunque el sem√°foro est√© en rojo.'], correct: 1 },
        { question: 'Si un conductor se encuentra con una luz roja intermitente en un sem√°foro, ¬øc√≥mo debe proceder?', options: ['Detenerse completamente y esperar la luz verde.', 'Continuar la marcha, ya que advierte peligro pero no obliga a detenerse.', 'Ceder el paso, continuando solo cuando sea seguro hacerlo.'], correct: 2 },
        { question: '¬øCu√°l es la finalidad principal de las se√±ales de tr√°nsito reglamentarias?', options: ['Orientar al conductor sobre destinos y lugares de inter√©s.', 'Advertir sobre peligros o riesgos permanentes en la v√≠a.', 'Notificar a los usuarios sobre prioridades, prohibiciones, restricciones y obligaciones.'], correct: 2 },
        { question: '¬øA qu√© responden las se√±ales de tr√°nsito de car√°cter transitorio, que generalmente son de color naranja?', options: ['A la presencia de riesgos o peligros de car√°cter no permanente, derivados de trabajos en la v√≠a.', 'A la proximidad de zonas escolares o de alta afluencia de peatones.', 'A la gu√≠a de rutas tur√≠sticas o servicios de inter√©s general.'], correct: 0 },
        { question: '¬øEn qu√© caso un conductor puede traspasar una l√≠nea longitudinal mixta (continua y segmentada) en la calzada?', options: ['√önicamente si va a realizar una maniobra de estacionamiento.', 'Solo si circula por el lado donde la l√≠nea es segmentada.', 'En ning√∫n caso, ya que la presencia de una l√≠nea continua lo proh√≠be siempre.'], correct: 1 },
        { question: '¬øQu√© indica la demarcaci√≥n de franjas amarillas diagonales que forman cuadrados en una intersecci√≥n?', options: ['Que es una zona de estacionamiento exclusivo para residentes.', 'Que el conductor no debe quedar detenido en la intersecci√≥n.', 'Que es una zona preferente para el cruce de ciclistas.'], correct: 1 },
        { question: 'Al ver un veh√≠culo de gran tama√±o realizando un viraje que excede el ancho de su pista, ¬øqu√© debe hacer un conductor que se encuentra detr√°s o al lado?', options: ['Adelantarlo r√°pidamente por el espacio que queda libre.', 'Usar la bocina para indicarle que apure la maniobra.', 'Detenerse y esperar a que el veh√≠culo finalice su maniobra.'], correct: 2 },
        { question: 'Al aproximarse a un cruce no se√±alizado y sin Carabineros, ¬øqui√©n tiene la preferencia de paso?', options: ['El veh√≠culo que se aproxima por la izquierda.', 'El veh√≠culo m√°s grande o de mayor velocidad.', 'Los veh√≠culos que se aproximan al cruce desde la derecha.'], correct: 2 },
        { question: 'Ante la aproximaci√≥n de un veh√≠culo de emergencia con sus se√±ales luminosas y/o ac√∫sticas activadas, ¬øcu√°l es la obligaci√≥n del conductor?', options: ['Aumentar la velocidad para no obstaculizarlo.', 'Mantener la trayectoria y velocidad, ya que el veh√≠culo de emergencia debe esquivarlo.', 'Cederle el derecho a v√≠a, desplaz√°ndose hacia un lado y deteni√©ndose si es necesario.'], correct: 2 },
        { question: 'Si un conductor extiende su brazo izquierdo horizontalmente por la ventana, ¬øqu√© maniobra est√° indicando?', options: ['Viraje a la derecha.', 'Viraje a la izquierda.', 'Disminuci√≥n de la velocidad o detenci√≥n.'], correct: 1 },
        { question: 'Para advertir una disminuci√≥n de velocidad o una detenci√≥n mediante se√±ales con el brazo, ¬øcu√°l es la forma correcta de hacerlo?', options: ['Extender el brazo en √°ngulo recto hacia arriba.', 'Extender el brazo horizontalmente.', 'Extender el brazo hacia abajo.'], correct: 2 },
        { question: '¬øEn qu√© consiste la "Regla de los Tres Segundos" para mantener una distancia segura en carretera?', options: ['Contar "mil uno, mil dos, mil tres" despu√©s de que el veh√≠culo de adelante pasa un punto fijo; si pasas el punto antes de terminar, est√°s muy cerca.', 'Mantener una distancia de tres veh√≠culos de separaci√≥n en todo momento.', 'Frenar durante tres segundos cada vez que el veh√≠culo de adelante frena.'], correct: 0 },
        { question: 'Al pasar cerca de veh√≠culos estacionados, ¬øqu√© distancia lateral es recomendable dejar y por qu√©?', options: ['Menos de 50 cm, para no invadir la otra pista.', 'Un espacio equivalente al ancho de una puerta, ya que alguien podr√≠a bajar del veh√≠culo repentinamente.', 'No hay una distancia espec√≠fica, solo se debe reducir la velocidad.'], correct: 1 },
        { question: '¬øCon qu√© anticipaci√≥n m√≠nima debe se√±alizar un conductor su intenci√≥n de virar?', options: ['10 metros antes.', 'A lo menos 30 metros antes.', 'Justo en el momento de girar el volante.'], correct: 1 },
        { question: 'Al detenerse en una intersecci√≥n para esperar a virar a la izquierda, ¬øhacia d√≥nde deben apuntar las ruedas delanteras y por qu√©?', options: ['Hacia la izquierda, para estar preparado para la maniobra de viraje.', 'Hacia adelante, para no ser lanzado hacia el tr√°fico en contra si es chocado por detr√°s.', 'Hacia la derecha, como medida de seguridad est√°ndar.'], correct: 1 },
        { question: '¬øEn cu√°l de los siguientes lugares est√° prohibido realizar un viraje en "U"?', options: ['En avenidas anchas con bandejones centrales, si no hay se√±al que lo proh√≠ba.', 'A menos de 200 m de una curva, cima, cruce ferroviario o puente.', 'En cualquier calle de doble tr√°nsito.'], correct: 1 },
        { question: 'Al llegar a una rotonda, ¬øqui√©n tiene la obligaci√≥n de ceder el paso?', options: ['Los veh√≠culos que ya est√°n circulando dentro de la rotonda deben ceder el paso a los que ingresan.', 'El veh√≠culo que desea ingresar a la rotonda debe ceder el paso a los que ya circulan en ella.', 'La preferencia la tiene el veh√≠culo que circula por la pista exterior de la rotonda.'], correct: 1 },
        { question: '¬øCu√°l es el l√≠mite de velocidad m√°ximo permitido en zonas urbanas para veh√≠culos livianos?', options: ['60 km/h.', '50 km/h.', '70 km/h.'], correct: 1 },
        { question: '¬øA qu√© velocidad m√°xima se debe reducir la marcha al circular por las afueras de un colegio durante las horas de entrada y salida de clases?', options: ['A 50 km/h.', 'A 20 km/h.', 'A no m√°s de 30 km/h.'], correct: 2 },
        { question: 'Al cruzarse con otro veh√≠culo, ¬øpor qu√© es dif√≠cil calcular correctamente el punto de encuentro?', options: ['Porque se tiende a creer que el cruce ser√° en la mitad de la distancia, lo cual solo es cierto si ambos van a la misma velocidad.', 'Porque los veloc√≠metros de los autos suelen ser imprecisos.', 'Porque la perspectiva visual siempre hace que los otros veh√≠culos parezcan m√°s lentos de lo que van.'], correct: 0 },
        { question: 'Analizando la ganancia de tiempo versus el riesgo, ¬øqu√© se concluye sobre aumentar la velocidad para adelantar?', options: ['Que la ganancia de tiempo es muy significativa y justifica el riesgo.', 'Que la ganancia de tiempo es m√≠nima en comparaci√≥n con la gran p√©rdida de seguridad que implica.', 'Que solo es √∫til aumentar la velocidad en tramos de m√°s de 100 kil√≥metros.'], correct: 1 },
        { question: '¬øCu√°ndo, excepcionalmente, se permite adelantar a un veh√≠culo por la derecha?', options: ['Siempre que el veh√≠culo de adelante vaya muy lento.', 'Cuando el veh√≠culo alcanzado est√© realizando un viraje a la izquierda, o en v√≠as urbanas con tres o m√°s pistas en el mismo sentido.', 'En carreteras de alta velocidad, para no obstaculizar la pista r√°pida.'], correct: 1 },
        { question: 'Al estacionar un veh√≠culo en una v√≠a p√∫blica urbana, ¬øa qu√© distancia m√°xima de la cuneta se debe hacer, si no se indica otra forma?', options: ['A no m√°s de 30 cent√≠metros.', 'A no m√°s de 60 cent√≠metros.', 'A 1 metro de distancia para facilitar la salida.'], correct: 0 },
        { question: '¬øQu√© significa la se√±al de tr√°nsito que muestra una letra "E" may√∫scula dentro de un c√≠rculo rojo con una l√≠nea diagonal que la cruza?', options: ['Que est√° prohibido estacionar y tambi√©n detenerse para tomar o dejar pasajeros.', 'Que en ese lugar no se debe estacionar.', 'Que el estacionamiento est√° permitido solo en horario nocturno.'], correct: 1 },
        { question: 'En caso de una emergencia que obligue a un conductor a descender de su veh√≠culo en la v√≠a, ¬øqu√© elemento de seguridad es obligatorio utilizar?', options: ['Un casco de seguridad.', 'Guantes de color claro.', 'Un chaleco de alta visibilidad.'], correct: 2 },
        { question: '¬øPor qu√© los peatones son considerados usuarios vulnerables en las v√≠as?', options: ['Porque suelen cometer infracciones, se distraen con tecnolog√≠as y sus movimientos son impredecibles.', 'Porque siempre tienen la preferencia, sin importar la situaci√≥n.', 'Porque la ley no los protege adecuadamente en caso de siniestros.'], correct: 0 },
        { question: '¬øQu√© caracter√≠stica del desarrollo visual de los ni√±os y ni√±as representa un riesgo en el tr√°nsito?', options: ['Que tienen una vista completamente desarrollada desde los 5 a√±os.', 'Que su vista no se desarrolla completamente hasta los 15 a√±os y tienen un campo visual limitado.', 'Que pueden juzgar distancias y velocidades con mayor precisi√≥n que un adulto.'], correct: 1 },
        { question: 'Al pasar con un veh√≠culo cerca de un ciclista, ¬øqu√© distancia lateral m√≠nima exige la normativa para garantizar su seguridad?', options: ['50 cent√≠metros.', 'Al menos 1,5 metros.', 'El ancho completo de una pista de circulaci√≥n.'], correct: 1 },
        { question: '¬øC√≥mo debe se√±alizar un ciclista un viraje a la derecha?', options: ['Extendiendo el brazo izquierdo hacia abajo.', 'Con el brazo izquierdo en √°ngulo recto hacia arriba o el brazo derecho extendido horizontalmente.', 'Mirando fijamente hacia la derecha antes de girar.'], correct: 1 },
        { question: 'Seg√∫n la Ley de Tr√°nsito en Chile, ¬øhasta qu√© edad es obligatorio transportar a los ni√±os en un Sistema de Retenci√≥n Infantil (SRI)?', options: ['Hasta los 4 a√±os.', 'Hasta los 12 a√±os, sin excepci√≥n.', 'Hasta los 8 a√±os inclusive, o si miden 135 cm o menos y pesan 33 kg o menos.'], correct: 2 },
        { question: '¬øC√≥mo debe pasar la banda superior del cintur√≥n de seguridad para que se considere que est√° correctamente posicionado en un ni√±o?', options: ['Por debajo del brazo y sobre el abdomen.', 'Por la mitad del hombro y el pecho.', 'Lo m√°s cerca posible del cuello.'], correct: 1 },
        { question: '¬øCu√°l es la recomendaci√≥n sobre la orientaci√≥n de la silla infantil (SRI) para que los ni√±os viajen m√°s seguros?', options: ['Siempre mirando hacia adelante para evitar mareos.', 'Mirando hacia atr√°s (a contramarcha) el mayor tiempo posible, como m√≠nimo hasta los dos a√±os.', 'En la direcci√≥n que el ni√±o o ni√±a prefiera para su comodidad.'], correct: 1 },
        { question: '¬øQu√© obligaci√≥n tiene un conductor que se incorpora a la circulaci√≥n desde una v√≠a particular o un estacionamiento?', options: ['Tiene preferencia sobre los peatones.', 'Debe ceder el paso a los veh√≠culos en tr√°nsito y a los peatones.', 'Puede incorporarse si se√±aliza con suficiente antelaci√≥n.'], correct: 1 },
        { question: '¬øEn qu√© situaci√≥n el uso de la bocina est√° estrictamente prohibido?', options: ['Al aproximarse a una curva con poca visibilidad.', 'Para apurar a un conductor que duda en un cruce.', 'En un t√∫nel, o a la entrada y salida de este.'], correct: 2 },
        { question: '¬øQu√© indica una l√≠nea amarilla continua pintada a lo largo de la solera (borde de la vereda)?', options: ['Que se permite estacionar por un m√°ximo de 10 minutos.', 'Que es una zona de carga y descarga en horarios espec√≠ficos.', 'La prohibici√≥n de estacionar a lo largo de esa franja.'], correct: 2 },
        { question: '¬øCu√°l es la velocidad m√°xima permitida para buses interurbanos en zonas no urbanas?', options: ['120 km/h.', '90 km/h.', '100 km/h.'], correct: 2 },
        { question: 'En una v√≠a rural de una pista por sentido, ¬øcu√°l es la velocidad m√°xima para veh√≠culos livianos?', options: ['100 km/h.', '120 km/h.', '90 km/h.'], correct: 0 },
        { question: '¬øQu√© es una "zona de espera especial" demarcada en algunos cruces semaforizados?', options: ['Un √°rea para la detenci√≥n de veh√≠culos de emergencia.', 'Una zona entre la l√≠nea de detenci√≥n y el paso peatonal para conductores de ciclos y/o motocicletas.', 'Un espacio reservado para que los peatones esperen la luz verde.'], correct: 1 },
        { question: '¬øQu√© debe hacer un conductor al enfrentar una se√±al CEDA EL PASO?', options: ['Detenerse completamente en todos los casos.', 'Reducir la velocidad, detenerse si es necesario y ceder el paso si hay riesgo de siniestro.', 'Continuar con la misma velocidad si no vienen veh√≠culos por la derecha.'], correct: 1 },
        { question: '¬øQu√© significa el t√©rmino "sobrepasar" a otro veh√≠culo, a diferencia de "adelantar"?', options: ['Es un sin√≥nimo de adelantar, no hay diferencia legal.', 'Significa situarse delante de otro veh√≠culo sin invadir la pista del sentido contrario.', 'Implica superar a otro veh√≠culo por la berma o fuera de la calzada.'], correct: 1 },
        { question: 'En un camino de monta√±a donde la nieve es frecuente, ¬øde qu√© color pueden ser las demarcaciones del eje central y de borde de calzada?', options: ['Rojas.', 'Azules.', 'Amarillas.'], correct: 2 },
        { question: 'Al estacionar en una v√≠a inclinada (en bajada), ¬øhacia d√≥nde deben quedar giradas las ruedas delanteras?', options: ['Hacia el centro de la calzada.', 'Hacia la cuneta.', 'Rectas, para no da√±ar la direcci√≥n.'], correct: 1 },
        { question: '¬øA qu√© distancia m√≠nima de un grifo para incendios est√° prohibido estacionar?', options: ['A menos de 10 metros.', 'A menos de 5 metros.', 'A menos de 20 metros.'], correct: 1 },
        { question: '¬øPor qu√© se debe tener especial cuidado con los peatones de edad avanzada?', options: ['Porque siempre cruzan por lugares no habilitados.', 'Porque pueden tener menor movilidad, reacciones m√°s lentas y dificultad para apreciar la velocidad de los veh√≠culos.', 'Porque la ley les otorga siempre la preferencia, incluso si cometen una infracci√≥n.'], correct: 1 },
        { question: '¬øPor qu√© no se debe confiar ciegamente en los sistemas de seguridad de un cruce ferroviario (barreras, luces)?', options: ['Porque el sistema podr√≠a fallar, por lo que siempre se debe verificar que no se acerca un tren.', 'Porque los trenes modernos son silenciosos y no los activan.', 'Porque est√°n dise√±ados solo para advertir a peatones, no a veh√≠culos.'], correct: 0 },
        { question: '¬øCu√°l es uno de los principales motivos por los que los siniestros de motociclistas resultan a menudo fatales?', options: ['El uso obligatorio de casco aumenta el riesgo de lesiones cervicales.', 'La falta de carrocer√≠a, que deja el cuerpo del conductor expuesto al impacto.', 'La alta velocidad a la que est√°n legalmente autorizados a circular.'], correct: 1 },
        { question: '¬øQu√© debe hacer un conductor al circular detr√°s de un ciclista que se aproxima a un cruce?', options: ['Adelantarlo antes del cruce para no perder tiempo.', 'Prestar atenci√≥n, ya que el ciclista podr√≠a querer virar sin se√±alizarlo.', 'Usar la bocina para que el ciclista sepa que est√° detr√°s.'], correct: 1 },
        { question: '¬øCu√°l es la sanci√≥n por no transportar a un menor en el Sistema de Retenci√≥n Infantil correspondiente?', options: ['Una advertencia verbal por parte de Carabineros.', 'Una falta leve, con una multa de 0,5 UTM.', 'Una falta grav√≠sima, con multa de 1,5 a 3 UTM y suspensi√≥n de licencia.'], correct: 2 },
        { question: 'Adem√°s de la edad, la talla y el peso, ¬øqu√© otro factor es crucial al elegir e instalar un SRI?', options: ['El color de la silla, para que combine con el interior del veh√≠culo.', 'Las caracter√≠sticas del veh√≠culo, como el tipo de anclaje (ISOFIX, LATCH) y el espacio disponible.', 'El precio, ya que las sillas m√°s caras son siempre las m√°s seguras.'], correct: 1 },
        { question: '¬øEn qu√© momento se debe empezar a usar un Sistema de Retenci√≥n Infantil?', options: ['A partir de los 6 meses de edad.', 'Desde el primer viaje del ni√±o, es decir, desde que nace.', 'Cuando el ni√±o ya puede sentarse sin ayuda.'], correct: 1 },
        { question: '¬øQu√© indica la se√±al vertical de advertencia de peligro con el s√≠mbolo de una cruz (Cruz de San Andr√©s)?', options: ['Proximidad de un cruce de caminos de igual importancia.', 'Proximidad de un hospital o zona de emergencia.', 'Proximidad a un cruce ferroviario.'], correct: 2 },
        { question: 'Si la luz amarilla de un sem√°foro te sorprende tan pr√≥ximo al cruce que no puedes detenerte con seguridad, ¬øqu√© debes hacer?', options: ['Frenar bruscamente, aunque sea sobre el paso de peatones.', 'Retroceder lentamente a una posici√≥n segura.', 'Continuar con precauci√≥n.'], correct: 2 },
        { question: '¬øQu√© significa la secuencia "espejo - se√±alizaci√≥n - maniobra"?', options: ['Es la secuencia correcta para estacionar en paralelo.', 'Es la secuencia que se debe seguir antes de realizar un cambio de pista o viraje.', 'Es una t√©cnica de manejo defensivo en caso de niebla.'], correct: 1 },
        { question: 'En una v√≠a con pistas exclusivas para buses, ¬øa qui√©nes afectan los sem√°foros especiales que all√≠ se instalan?', options: ['A todos los veh√≠culos de la intersecci√≥n.', 'Solo a los veh√≠culos que circulan por la pista exclusiva.', 'A los peatones que quieran cruzar esa v√≠a.'], correct: 1 },
        { question: '¬øCu√°l es el principal riesgo de conducir manteniendo una distancia muy corta con el veh√≠culo de adelante?', options: ['Aumenta el consumo de combustible de forma irregular.', 'Reduce la visibilidad hacia adelante, dificulta los adelantamientos y aumenta el riesgo de siniestros por alcance.', 'Desgasta prematuramente los neum√°ticos.'], correct: 1 },
        { question: '¬øPor qu√© raz√≥n se debe tener especial cuidado con un veh√≠culo con patente extranjera?', options: ['Porque suelen circular a exceso de velocidad.', 'Porque el conductor podr√≠a desconocer el lugar y frenar o virar inesperadamente.', 'Porque sus seguros no son v√°lidos en Chile.'], correct: 1 },
        { question: '¬øPor qu√© al finalizar un adelantamiento se debe volver a la pista derecha solo despu√©s de ver al veh√≠culo adelantado en el espejo retrovisor interior?', options: ['Para asegurarse de haber dejado una distancia lateral suficiente.', 'Para confirmar que el otro conductor no iniciar√° tambi√©n un adelantamiento.', 'Para garantizar que existe una distancia segura y no forzarlo a frenar.'], correct: 2 },
        { question: '¬øEn qu√© situaci√≥n un conductor pierde toda preferencia de paso?', options: ['Al circular por una rotonda.', 'Cuando tiene el prop√≥sito de virar.', 'Al circular por una avenida principal.'], correct: 1 },
        { question: '¬øSe permite retroceder en un cruce si ya se ha traspasado la l√≠nea de detenci√≥n?', options: ['S√≠, siempre que se haga lentamente.', 'Solo si no vienen otros veh√≠culos.', 'No, a menos que un Carabinero d√© una indicaci√≥n expresa.'], correct: 2 },
        { question: '¬øQu√© representa el hecho de que un peat√≥n utilice aud√≠fonos a un volumen alto?', options: ['Una forma de entretenimiento que no afecta la seguridad.', 'Un riesgo, ya que se a√≠sla ac√∫sticamente del entorno y del tr√°nsito.', 'Una se√±al de que tiene dificultades auditivas y necesita m√°s tiempo para cruzar.'], correct: 1 },
        { question: '¬øA partir de qu√© edad se considera que los ni√±os comienzan a actuar con relativa seguridad en el tr√°nsito?', options: ['Entre los 5 y 7 a√±os.', 'Entre los 9 y 12 a√±os.', 'A partir de los 14 a√±os.'], correct: 1 },
        { question: '¬øQu√© se debe hacer al pasar cerca de animales en la carretera o camino?', options: ['Acelerar para pasarlos r√°pidamente y no asustarlos.', 'No hacer se√±ales luminosas o ac√∫sticas, ya que podr√≠an asustarse.', 'Tocar la bocina para que se alejen de la calzada.'], correct: 1 },
        { question: '¬øPor qu√© una gran cantidad de los siniestros en virajes a la izquierda corresponden a choques por atr√°s?', options: ['Porque los conductores no se√±alizan la maniobra.', 'Porque es una maniobra que a menudo requiere reducir la velocidad o detenerse en la v√≠a.', 'Porque los veh√≠culos que vienen en contra suelen ceder el paso.'], correct: 1 },
        { question: 'Si la pista por la que circulas se ve sorpresivamente obstaculizada, ¬øtienes prioridad para cambiarte de pista?', options: ['S√≠, los dem√°s deben cederte el paso.', 'Carecer√°s de prioridad frente a los dem√°s veh√≠culos.', 'Solo si se√±alizas con las luces de emergencia.'], correct: 1 },
        { question: '¬øQu√© indica una se√±al de mensaje variable en la calzada con una equis (X) de color rojo?', options: ['Que la pista est√° abierta al tr√°nsito.', 'Que se debe circular con precauci√≥n.', 'Que la pista est√° cerrada.'], correct: 2 },
        { question: 'Al aproximarse a un paso de cebra, ¬øcu√°l es la obligaci√≥n principal del conductor?', options: ['Tocar la bocina para advertir a los peatones.', 'Detenerse y ceder el paso si alguien se dispone a cruzar.', 'Mantener la velocidad, ya que los peatones deben esperar.'], correct: 1 },
        { question: '¬øCu√°l es la principal caracter√≠stica de las se√±ales de advertencia de peligro?', options: ['Son de forma circular con fondo blanco y orla roja.', 'Tienen forma de rombo con fondo amarillo y s√≠mbolo negro.', 'Son de forma rectangular con fondo azul o verde.'], correct: 1 },
        { question: '¬øQu√© riesgo principal reduce el uso del casco en los ciclistas?', options: ['Reduce el riesgo de fracturas en las extremidades.', 'Reduce la probabilidad de sufrir lesiones en la cabeza hasta tres veces.', 'Mejora la aerodin√°mica para ir m√°s r√°pido.'], correct: 1 },
        { question: '¬øEst√° permitido circular, detenerse o estacionar en una ciclov√≠a?', options: ['S√≠, si es solo por un momento para subir o bajar un pasajero.', 'Solo pueden hacerlo las motocicletas.', 'No, no est√° permitido para los veh√≠culos motorizados.'], correct: 2 },
        { question: 'En un veh√≠culo particular, ¬ød√≥nde est√° prohibido el traslado de menores de 12 a√±os?', options: ['En el asiento trasero, si no usan silla especial.', 'En los asientos delanteros.', 'En cualquier asiento si el viaje dura m√°s de una hora.'], correct: 1 },
        { question: '¬øQu√© peligro puede generar el uso incorrecto del cintur√≥n de seguridad en un ni√±o?', options: ['Lesiones en el cuello por quedar muy suelto.', 'Lesiones importantes en √≥rganos abdominales como h√≠gado, intestinos y ri√±ones.', 'Solo una sensaci√≥n de incomodidad sin mayores riesgos.'], correct: 1 },
        { question: '¬øQu√© se debe hacer si se conduce por la pista izquierda y un veh√≠culo en la pista derecha se detiene antes de un paso de cebra?', options: ['Continuar a la misma velocidad, ya que la pista est√° despejada.', 'Tocar la bocina para que el otro veh√≠culo avance.', 'Disminuir la velocidad y prepararse para detenerse, pues podr√≠an haber peatones cruzando.'], correct: 2 },
        { question: '¬øA qu√© se debe el aumento de riesgo al conducir en una calle arbolada en un d√≠a soleado?', options: ['A la posibilidad de que caigan ramas sobre la calzada.', 'A la visibilidad cambiante por la luz y sombra, que dificulta percibir a otros usuarios y calcular distancias.', 'A que las ra√≠ces de los √°rboles pueden da√±ar el pavimento.'], correct: 1 },
        { question: 'Si dos veh√≠culos circulan en sentido contrario a 90 km/h cada uno, ¬øa qu√© velocidad se aproximan entre s√≠?', options: ['A 90 km/h.', 'A la suma de las velocidades, es decir, 180 km/h.', 'A la velocidad del veh√≠culo m√°s r√°pido.'], correct: 1 },
        { question: '¬øEn qu√© lugar, adem√°s de un cruce, est√° prohibido adelantar, incluso si no se necesita traspasar el eje de la calzada?', options: ['En una recta con buena visibilidad.', 'En un paso para peatones.', 'Al pasar frente a un establecimiento comercial.'], correct: 1 },
        { question: 'Al estacionar de noche en una v√≠a sin alumbrado p√∫blico, ¬øqu√© precauci√≥n se debe tomar?', options: ['Dejar las luces de emergencia intermitentes.', 'Tocar la bocina cada cierto tiempo.', 'Mantener encendidas las luces de estacionamiento.'], correct: 2 },
        { question: '¬øQu√© debe hacer si al circular se encuentra con un veh√≠culo de transporte escolar detenido tomando o dejando pasajeros?', options: ['Adelantarlo r√°pidamente por la izquierda.', 'Reducir la velocidad y detenerse si es necesario.', 'Continuar a la misma velocidad, pero por la pista contraria.'], correct: 1 },
        { question: '¬øA qu√© distancia m√≠nima de una esquina est√° prohibido estacionar?', options: ['A menos de 5 metros.', 'A menos de 10 metros.', 'A menos de 3 metros.'], correct: 1 },
        { question: 'Si una se√±al de prohibici√≥n de estacionar se complementa con una leyenda de horarios, ¬øqu√© significa?', options: ['Que la prohibici√≥n es v√°lida las 24 horas del d√≠a.', 'Que la prohibici√≥n se limita a los d√≠as y horarios indicados en la leyenda.', 'Que en ese horario solo pueden estacionar veh√≠culos comerciales.'], correct: 1 },
        { question: 'Si un peat√≥n tiene alg√∫n impedimento f√≠sico o sensorial, ¬øest√° obligado a mostrarlo?', options: ['S√≠, debe usar un distintivo visible.', 'No, no tienen la obligaci√≥n de mostrarlo.', 'Solo si el impedimento afecta su movilidad.'], correct: 1 },
        { question: '¬øPor qu√© no se debe asumir que un peat√≥n mayor puede escuchar su veh√≠culo?', options: ['Porque suelen usar aud√≠fonos con m√∫sica.', 'Porque pueden tener dificultades auditivas y el ruido ambiente puede dificultarles o√≠r.', 'Porque solo prestan atenci√≥n a las se√±ales de los sem√°foros.'], correct: 1 },
        { question: '¬øCu√°l es una de las principales causas de siniestros donde participan ni√±as y ni√±os?', options: ['Que cruzan la calle caminando lentamente.', 'Que cruzan repentinamente la calle corriendo.', 'Que siempre van acompa√±ados de un adulto responsable.'], correct: 1 },
        { question: '¬øQu√© garantiza la etiqueta amarilla con letras negras que deben llevar las sillas infantiles en Chile?', options: ['Que es el modelo m√°s caro del mercado.', 'Que la silla est√° certificada bajo normativas de seguridad y acreditada en el pa√≠s.', 'Que la silla es compatible con todos los modelos de veh√≠culos.'], correct: 1 },
        { question: 'Al conducir por una autopista, ¬øpor qu√© es f√°cil dejarse enga√±ar y no darse cuenta de la alta velocidad a la que se circula?', options: ['Porque los veloc√≠metros se descalibran a altas velocidades.', 'Porque despu√©s de un rato, la velocidad se siente agradable y se produce una "ceguera por la velocidad".', 'Porque el ruido del viento distorsiona la percepci√≥n del conductor.'], correct: 1 },
        { question: 'Si un veh√≠culo que te sigue ha comenzado a adelantarte, ¬øpuedes iniciar t√∫ una maniobra de adelantamiento a otro veh√≠culo?', options: ['S√≠, si tienes espacio suficiente.', 'No, debes esperar a que el veh√≠culo de atr√°s termine su maniobra.', 'Solo si el veh√≠culo de adelante va muy lento.'], correct: 1 },
        { question: '¬øQu√© acci√≥n debe realizar un conductor cuando es adelantado por otro veh√≠culo?', options: ['Aumentar la velocidad para que la maniobra dure menos.', 'Facilitar el adelantamiento manteni√©ndose lo m√°s a la derecha posible y no aumentando la velocidad.', 'Moverse hacia el centro de la calzada para proteger su posici√≥n.'], correct: 1 },
        { question: 'Adem√°s de Carabineros, ¬øqu√© otras entidades est√°n encargadas de velar por el cumplimiento de las normas de circulaci√≥n?', options: ['Solo el personal de seguridad de las autopistas.', 'Los conserjes de edificios y guardias privados.', 'Inspectores Fiscales e Inspectores Municipales.'], correct: 2 },
        { question: '¬øQu√© ocurre con el campo visual del conductor a medida que aumenta la velocidad?', options: ['Se ampl√≠a, permitiendo ver m√°s detalles a los costados.', 'Se reduce.', 'No sufre ninguna alteraci√≥n.'], correct: 1 },
        { question: '¬øCu√°l es la distancia m√≠nima que debe dejarse entre un veh√≠culo estacionado y otro, adelante o atr√°s?', options: ['30 cent√≠metros.', '60 cent√≠metros.', '1 metro.'], correct: 1 }
    ];
    // --- VARIABLES GLOBALES ---
    let currentQuestionIndex;
    let userAnswers;
    let timerInterval;
    let shuffledQuestions = [];
    let passMark; // NUEVO

    // --- ELEMENTOS DEL DOM ---
    const startScreen = document.getElementById('start-screen');
    const examScreen = document.getElementById('exam-screen');
    const resultsScreen = document.getElementById('results-screen');
    const startBtn = document.getElementById('start-btn');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const restartBtn = document.getElementById('restart-btn');
    const resetExamBtn = document.getElementById('reset-exam-btn');
    const timeSelect = document.getElementById('time-select');
    const passMarkSelect = document.getElementById('pass-mark-select'); // NUEVO
    const startText = document.getElementById('start-text');
    const timerDisplay = document.getElementById('timer-display');
    const questionNumberEl = document.getElementById('question-number');
    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const resultsTitle = document.getElementById('results-title');
    const correctCountEl = document.getElementById('correct-count');
    const incorrectCountEl = document.getElementById('incorrect-count');
    const totalCountEl = document.getElementById('total-count');
    const finalScoreEl = document.getElementById('final-score');
    const examStatusEl = document.getElementById('exam-status');
    const reviewSection = document.getElementById('review-section');
    const incorrectAnswersList = document.getElementById('incorrect-answers-list');
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body; 

    // --- FUNCIONES ---

    function toggleTheme() {
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            localStorage.setItem('theme', 'light-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark-mode') {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            body.classList.remove('dark-mode');
            themeToggle.textContent = 'üåì';
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function randomizeQuestionOptions() {
        shuffledQuestions = JSON.parse(JSON.stringify(questions));
        shuffledQuestions.forEach(q => {
            const correctAnswerText = q.options[q.correct];
            shuffleArray(q.options);
            const newCorrectIndex = q.options.findIndex(option => option === correctAnswerText);
            q.correct = newCorrectIndex;
        });
    }

    function initializeApp() {
        if (questions.length > 0) {
            startText.textContent = `Prep√°rate con ${questions.length} preguntas.`;
            startBtn.disabled = false;
        } else {
            startText.textContent = 'No hay preguntas cargadas. Agrega preguntas en el array "questions" para comenzar.';
            startBtn.disabled = true;
        }
        startBtn.addEventListener('click', startExam);
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', prevQuestion);
        restartBtn.addEventListener('click', restartExam);
        resetExamBtn.addEventListener('click', restartExam);
        themeToggle.addEventListener('click', toggleTheme);
        loadTheme();
    }

    function startExam() {
      randomizeQuestionOptions();
      currentQuestionIndex = 0;
      userAnswers = new Array(shuffledQuestions.length).fill(null);
      startScreen.classList.add('hidden');
      resultsScreen.classList.add('hidden');
      examScreen.classList.remove('hidden');
      reviewSection.classList.add('hidden');
      
      // NUEVO: Capturar el valor de la nota de aprobaci√≥n
      passMark = parseInt(passMarkSelect.value, 10);
      
      const durationMinutes = parseInt(timeSelect.value, 10);
      startTimer(durationMinutes);
      showQuestion();
    }
    
    function showQuestion() {
        const q = shuffledQuestions[currentQuestionIndex];
        if (!q) return; 

        updateProgress();
        questionNumberEl.textContent = `Pregunta ${currentQuestionIndex + 1}`;
        questionTextEl.textContent = q.question;
        optionsContainer.innerHTML = '';
        const answered = userAnswers[currentQuestionIndex] !== null;
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option';
            btn.innerHTML = `<span class="option-letter">${String.fromCharCode(65 + idx)}</span>${opt}`;
            btn.onclick = () => selectOption(idx);
            
            if (answered) {
               btn.classList.add('disabled');
                if (idx === q.correct) {
                    btn.classList.add('correct');
                } else if (idx === userAnswers[currentQuestionIndex]) {
                    btn.classList.add('incorrect');
                 }
            }
            optionsContainer.appendChild(btn);
        });
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.textContent = (currentQuestionIndex === shuffledQuestions.length - 1) ? 'Finalizar Examen' : 'Siguiente ‚Üí';
    }

    function selectOption(selectedIndex) {
      if (userAnswers[currentQuestionIndex] !== null) return; 
      userAnswers[currentQuestionIndex] = selectedIndex;
      showQuestion();
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < shuffledQuestions.length - 1) {
        currentQuestionIndex++;
        showQuestion();
      } else {
        showResults("¬°Examen Completado!");
      }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            showQuestion();
        }
    }

    function showResults(title) {
        clearInterval(timerInterval);
        examScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        resultsTitle.textContent = title;
        const correctCount = userAnswers.filter((answer, index) => answer === shuffledQuestions[index].correct).length;
        const totalAnswered = userAnswers.filter(answer => answer !== null).length;
        const incorrectCount = totalAnswered - correctCount;
        const score = shuffledQuestions.length > 0 ? Math.round((correctCount / shuffledQuestions.length) * 100) : 0;
        
        correctCountEl.textContent = correctCount;
        incorrectCountEl.textContent = incorrectCount;
        totalCountEl.textContent = shuffledQuestions.length;
        finalScoreEl.textContent = `${score}%`;

        // NUEVO: Usar la variable 'passMark' en lugar de un valor fijo
        if (score >= passMark) {
            examStatusEl.textContent = 'Aprobado';
            examStatusEl.className = 'score-value status passed';
        } else {
            examStatusEl.textContent = 'Reprobado';
            examStatusEl.className = 'score-value status failed';
        }
        
        displayIncorrectAnswers();
    }

    function displayIncorrectAnswers() {
        incorrectAnswersList.innerHTML = '';
        const incorrectAnswers = [];

        userAnswers.forEach((answer, index) => {
            if (answer !== null && answer !== shuffledQuestions[index].correct) {
                const q = shuffledQuestions[index];
                incorrectAnswers.push({
                    questionNumber: index + 1,
                    question: q.question,
                    userAnswer: q.options[answer],
                    correctAnswer: q.options[q.correct]
                });
            }
        });
        if (incorrectAnswers.length > 0) {
            reviewSection.classList.remove('hidden');
            incorrectAnswers.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'incorrect-answer-item';
                itemEl.innerHTML = `
                    <p><strong>Pregunta ${item.questionNumber}:</strong> ${item.question}</p>
                    <p class="user-answer"><strong>Tu respuesta:</strong> ${item.userAnswer}</p>
                    <p class="correct-answer"><strong>Respuesta correcta:</strong> ${item.correctAnswer}</p>
                `;
                incorrectAnswersList.appendChild(itemEl);
            });
        } else {
            reviewSection.classList.add('hidden');
        }
    }

    function restartExam() {
        clearInterval(timerInterval);
        startScreen.classList.remove('hidden');
        examScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        reviewSection.classList.add('hidden');
        initializeApp(); // Re-inicializamos para verificar si hay preguntas
    }

    function startTimer(minutes) {
        let timeInSeconds = minutes * 60;
        timerInterval = setInterval(() => {
            if (timeInSeconds <= 0) {
                clearInterval(timerInterval);
                timerDisplay.textContent = "00:00";
                showResults("¬°Se acab√≥ el tiempo!");
                return;
               }

            timeInSeconds--;
            const remMinutes = Math.floor(timeInSeconds / 60);
            const remSeconds = timeInSeconds % 60;
            timerDisplay.textContent = `${String(remMinutes).padStart(2, '0')}:${String(remSeconds).padStart(2, '0')}`;
        }, 1000);
    }
    
    function updateProgress() {
      const percentage = shuffledQuestions.length > 0 ?
      ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100 : 0;
      progressFill.style.width = percentage + '%';
      progressText.textContent = `Pregunta ${currentQuestionIndex + 1} de ${shuffledQuestions.length}`;
    }

    // --- INICIAR APP ---
    initializeApp();
});
</script>
</body>
</html>